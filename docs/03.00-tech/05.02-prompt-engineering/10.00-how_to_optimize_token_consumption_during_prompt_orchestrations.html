<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dario Airoldi">
<meta name="dcterms.date" content="2026-01-25">
<meta name="description" content="Master token optimization strategies for multi-agent workflows: context reduction, deterministic tools, semantic caching, and provider caching to reduce costs by up to 90%">

<title>How to Optimize Token Consumption During Prompt Orchestrations ‚Äì Dario‚Äôs Learning Journey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../03.00-tech/05.02-prompt-engineering/20-how_to_create_a_prompt_interacting_with_agents.html" rel="next">
<link href="../../03.00-tech/05.02-prompt-engineering/09.00-how_to_manage_information_flow_during_prompt_orchestrations.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3a62b57c7ce0f47a491e97fb1cd0ccc4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Learning Hub</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../README.html" aria-current="page"> <i class="bi bi-house-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-news" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">News</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-news">    
        <li class="dropdown-header">Latest Updates</li>
        <li>
    <a class="dropdown-item" href="../../01.00-news/20260130-6-advanced-rules-for-production-copilot-agents/summary.html">
 <span class="dropdown-text">6 Advanced Rules for Copilot Agents</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../01.00-news/20260124-copilotstudio-sdk/github-copilot-sdk-building-agents-for-any-application.html">
 <span class="dropdown-text">GitHub Copilot SDK - Building Agents</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../01.00-news/20260111-6-vital-rules-for-production-ready-copilot-agents/summary.html">
 <span class="dropdown-text">6 VITAL Rules for Copilot Agents</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../01.00-news/20251224-vscode-v1.107-release/01-summary.html">
 <span class="dropdown-text">VS Code v1.107 Release Summary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../01.00-news/20251224-vscode-v1.107-release/02-readme.sonnet4.html">
 <span class="dropdown-text">VS Code v1.107 Release Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-events" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Events</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-events">    
        <li class="dropdown-header">No events currently available</li>
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Event content coming soon‚Ä¶</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-architectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Architectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-architectures">    
        <li>
    <a class="dropdown-item" href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/01-podcast-and-rss-feed-information-gathering-and-analysis.html">
 <span class="dropdown-text">Podcast and RSS Feed Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/02-analyzing-atom-and-rss-specifications.html">
 <span class="dropdown-text">Analyzing Atom and RSS Specifications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/03-additional-metadata-for-rss-and-atom-feeds.html">
 <span class="dropdown-text">Additional Metadata for RSS and Atom Feeds</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/04-c#-reference-classes-for-reading-feeds.html">
 <span class="dropdown-text">C# Reference Classes for Reading Feeds</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-azure" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Azure</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-azure">    
        <li>
    <a class="dropdown-item" href="../../03.00-tech/02.01-azure/00-azure-naming-conventions/readme.html">
 <span class="dropdown-text">Azure Best Practices</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Security &amp; Identity</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/01.01-authentication/20251102-authenticating-external-users-in-azure-ad/01-external-users-authentication-in-azure-ad-explained.html">
 <span class="dropdown-text">Azure AD External Users Explained</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/01.01-authentication/20251102-authenticating-external-users-in-azure-ad/02-external-users-types-and-invitation-process.html">
 <span class="dropdown-text">External Users Types &amp; Invitation</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Data Services</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/03.01-data/01-table-storage-access-options/readme.html">
 <span class="dropdown-text">Table Storage Access</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/03.01-data/03-blob-storage-access-options/01-blob-storage-access-options.html">
 <span class="dropdown-text">Blob Storage Access Options</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/03.01-data/03-blob-storage-access-options/02-blob-storage-limitations.html">
 <span class="dropdown-text">Blob Storage Limitations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/03.01-data/02-cosmosdb-access-options/01-azure-cosmosdb-access-options.html">
 <span class="dropdown-text">CosmosDB Access</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-markdown--docs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Markdown &amp; Docs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-markdown--docs">    
        <li class="dropdown-header">Quarto Documentation</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/01.01-introduction-to-quarto.html">
 <span class="dropdown-text">Using Quarto (Overview)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/01.02-how-quarto-works.html">
 <span class="dropdown-text">Quarto Architecture: How It Works</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/02.01-monolithic-vs-modular-deployment.html">
 <span class="dropdown-text">Quarto: Monolithic vs.&nbsp;Modular Deployment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/02.02-split-navigation-build.html">
 <span class="dropdown-text">Quarto: Split Navigation Build</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/03.01-quarto-yml-structure.html">
 <span class="dropdown-text">Quarto.yml Document Structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/05.01-theming-and-styling.html">
 <span class="dropdown-text">Quarto Theming and Styling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/04.01-markdown-features.html">
 <span class="dropdown-text">Quarto-Specific Markdown Features</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/07.01-build-optimization.html">
 <span class="dropdown-text">Optimizing Quarto Build &amp; Deploy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/06.01-sidebar-layout.html">
 <span class="dropdown-text">How Quarto Sidebar Works</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/06.02-navigation-workflow.html">
 <span class="dropdown-text">Quarto Navigation Workflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/06.03-transition-optimization.html">
 <span class="dropdown-text">Sidebar Page Transition Optimization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/08.01-troubleshooting-guide.html">
 <span class="dropdown-text">Troubleshooting Quarto Sites</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/09.01-github-pages-deployment.html">
 <span class="dropdown-text">Deploying Quarto to GitHub Pages</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/09.02-azure-storage-deployment.html">
 <span class="dropdown-text">Deploying Quarto to Azure Storage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/01-quarto/10.01-customizing-markdown-rendering-with-lua-filters.html">
 <span class="dropdown-text">Customizing with Lua Filters</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">MkDocs Documentation</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/02-mkdocs/000.000-using-mkdocs.html">
 <span class="dropdown-text">Using MkDocs (Overview)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/02-mkdocs/001.001-architecture-how-mkdocs-works.html">
 <span class="dropdown-text">MkDocs Architecture: How It Works</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/02-mkdocs/001.002-architecture-monolithic-vs.-modular-deployment.html">
 <span class="dropdown-text">MkDocs: Monolithic vs.&nbsp;Modular Deployment</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Hugo Documentation</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/03-hugo/readme.html">
 <span class="dropdown-text">Hugo Series Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/03-hugo/01.01-introduction-to-hugo.html">
 <span class="dropdown-text">Introduction to Hugo</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/03-hugo/01.02-hugo-core-concepts.html">
 <span class="dropdown-text">Hugo Core Concepts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/03-hugo/01.03-goldmark-markdown-processing.html">
 <span class="dropdown-text">Goldmark Markdown Processing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/03-hugo/01.04-hugo-vs-quarto.html">
 <span class="dropdown-text">Hugo vs Quarto Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/20.01-markdown/03-hugo/05.03-rendering-learning-hub-with-hugo.html">
 <span class="dropdown-text">Rendering Learning Hub with Hugo</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-technologies" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Technologies</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-technologies">    
        <li class="dropdown-header">GitHub &amp; Version Control</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.01-github/01.01-cli/20250709-manage-gitrepo-from-commandline/readme.html">
 <span class="dropdown-text">Git Command Line</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.01-github/01.01-cli/20250118-github-cli/cli-commands-for-github.html">
 <span class="dropdown-text">GitHub CLI Commands</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Prompt Engineering</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/03.00-how_to_structure_content_for_copilot_prompt_files.html">
 <span class="dropdown-text">Structuring Prompt Files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/04.00-how_to_structure_content_for_copilot_agent_files.html">
 <span class="dropdown-text">Structuring Agent Files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/05.00-how_to_structure_content_for_copilot_instruction_files.html">
 <span class="dropdown-text">Structuring Instruction Files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/06.00-how_to_structure_content_for_copilot_skills.html">
 <span class="dropdown-text">Structuring Skill Files</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/07.00-how_to_create_mcp_servers_for_copilot.html">
 <span class="dropdown-text">Creating MCP Servers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/08.00-how_to_optimize_prompts_for_specific_models.html">
 <span class="dropdown-text">Optimizing Prompts for Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/09.00-how_to_manage_information_flow_during_prompt_orchestrations.html">
 <span class="dropdown-text">Managing Information Flow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/05.02-prompt-engineering/20-how_to_create_a_prompt_interacting_with_agents.html">
 <span class="dropdown-text">Prompt Orchestrations with Agents</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Technical Writing</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/40.00-technical-writing/00-foundations-of-technical-documentation.html">
 <span class="dropdown-text">Foundations of Technical Docs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/40.00-technical-writing/microsoft-writing-style-guide/00-microsoft-style-guide-overview.html">
 <span class="dropdown-text">Microsoft Style Guide</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">API Testing &amp; Tools</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/10.01-httpclient/20250713-use-http-files-for-easy-and-repeatable-test/00-http-rest-api-testing-tools-comprehensive-comparison.html">
 <span class="dropdown-text">HTTP/REST API Testing Comparison</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/10.01-httpclient/20250713-use-http-files-for-easy-and-repeatable-test/readme.html">
 <span class="dropdown-text">Using .http Files (VSCode)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Programming &amp; Hardware</li>
        <li>
    <a class="dropdown-item" href="../../03.00-tech/04.01-programming-languages/20250827-what-is-yq-overview/readme.html">
 <span class="dropdown-text">yq YAML Processor</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../03.00-tech/60.01-hardware/surface-laptop-6-features-analysis.html">
 <span class="dropdown-text">Surface Laptop 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to-guides" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How-To Guides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to-guides">    
        <li>
    <a class="dropdown-item" href="../../04.00-howto/20251108-howto-configure-promot-files-for-markdown-preview-in-visual-studio.html">
 <span class="dropdown-text">Configure .prompt Files in VS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../04.00-howto/20251013-howto-expose-my-computer-with-no-ip-ddns/howto.expose-my-computer-with-no-ip-ddns.html">
 <span class="dropdown-text">No-IP DDNS Setup</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ideas--projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Ideas &amp; Projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-ideas--projects">    
        <li>
    <a class="dropdown-item" href="../../06.00-idea/learning-hub/01-learning-hub-overview/01-learning-hub-introduction.html">
 <span class="dropdown-text">Learning Hub Overview</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="../../#"> <i class="bi bi-bell-fill" role="img" aria-label="Intelligent Notifications">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../#"> <i class="bi bi-rss" role="img" aria-label="Intelligent Feeds">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../#"> <i class="bi bi-sliders" role="img" aria-label="Intelligent Rules">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/darioairoldi/Learn"> <i class="bi bi-github" role="img" aria-label="GitHub Repository">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Technologies</li><li class="breadcrumb-item"><a href="../../03.00-tech/05.02-prompt-engineering/02.00-how_to_name_and_organize_prompt_files.html">Prompt Engineering</a></li><li class="breadcrumb-item"><a href="../../03.00-tech/05.02-prompt-engineering/10.00-how_to_optimize_token_consumption_during_prompt_orchestrations.html">How to Optimize Token Consumption During Prompt Orchestrations</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../README.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house-fill" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true"><i class="bi bi-newspaper" role="img">
</i> 
 <span class="menu-text">News &amp; Updates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01.00-news/20260130-6-advanced-rules-for-production-copilot-agents/summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">20260130 - 6 Advanced Rules For Production Copilot Agents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01.00-news/20260124-copilotstudio-sdk/github-copilot-sdk-building-agents-for-any-application.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">20260124 - GitHub Copilot SDK Building Agents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01.00-news/20260111-6-vital-rules-for-production-ready-copilot-agents/summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">20260111 - 6 Vital Rules For Production Ready Copilot Agents</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">20251224 VS Code v1.107 Release</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01.00-news/20251224-vscode-v1.107-release/01-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../01.00-news/20251224-vscode-v1.107-release/02-readme.sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true"><i class="bi bi-calendar-event" role="img">
</i> 
 <span class="menu-text">Events</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">No events currently available</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true"><i class="bi bi-cpu" role="img">
</i> 
 <span class="menu-text">Technologies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true"><i class="bi bi-shield-lock" role="img">
</i> 
 <span class="menu-text">Authentication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">20251102 Authenticating External Users in Azure Ad</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/01.01-authentication/20251102-authenticating-external-users-in-azure-ad/01-external-users-authentication-in-azure-ad-explained.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Users Authentication in Azure AD Explained</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/01.01-authentication/20251102-authenticating-external-users-in-azure-ad/02-external-users-types-and-invitation-process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External User Types and Invitation Process in Azure AD/Entra ID</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true"><i class="bi bi-cloud" role="img">
</i> 
 <span class="menu-text">Azure</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/02.01-azure/00-azure-naming-conventions/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Azure Naming Conventions</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true"><i class="bi bi-database" role="img">
</i> 
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">01 Table Storage Access Options</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/03.01-data/01-table-storage-access-options/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Azure Table Storage Access with C#</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">02 Cosmosdb Access Options</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/03.01-data/02-cosmosdb-access-options/01-azure-cosmosdb-access-options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üåê Azure CosmosDB Access Options (with C#)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/03.01-data/02-cosmosdb-access-options/02-cosmosdb-partitioning-strategies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üéØ CosmosDB Partitioning Strategies</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">03 Blob Storage Access Options</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/03.01-data/03-blob-storage-access-options/01-blob-storage-access-options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Azure Blob Storage Access Approaches with C#</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/03.01-data/03-blob-storage-access-options/02-blob-storage-limitations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">‚ö†Ô∏è Azure Blob Storage Limitations</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true"><i class="bi bi-code-slash" role="img">
</i> 
 <span class="menu-text">Programming Languages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">20250827 What Is Yq Overview</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/04.01-programming-languages/20250827-what-is-yq-overview/appendix-advanced-techniques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix B: Advanced YAML to JSON Conversion Techniques</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/04.01-programming-languages/20250827-what-is-yq-overview/appendix-yq-tool.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix A: The yq Tool - Complete Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/04.01-programming-languages/20250827-what-is-yq-overview/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Convert YAML to JSON - Complete Guide</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="true"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">GitHub</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false">
 <span class="menu-text">01 Repositories</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false">
 <span class="menu-text">20250825 Github Repositories Limitations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/01-repositories/20250825-github-repositories-limitations/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overcoming GitHub Repository Limitations</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false">
 <span class="menu-text">01.01 Cli</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-17" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false">
 <span class="menu-text">20250118 Github Cli</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-18" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/01.01-cli/20250118-github-cli/cli-commands-for-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üöÄ CLI Commands to Interact with GitHub Repositories</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false">
 <span class="menu-text">20250709 Manage Gitrepo from Commandline</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-19" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/01.01-cli/20250709-manage-gitrepo-from-commandline/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HowTo: Manage your Git repo from the command line</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false">
 <span class="menu-text">02 Actions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-20" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false">
 <span class="menu-text">20251018 Issue Github Action Fails with Artifact Storage Quota Has Been Hit</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-21" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/02-actions/20251018-issue-github-action-fails-with-artifact-storage-quota-has-been-hit/01-readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ISSUE: Github action fails with ‚ÄòArtifact storage quota has been hit‚Äô</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/02-actions/20251018-issue-github-action-fails-with-artifact-storage-quota-has-been-hit/02-quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start Guide - Fixing Artifact Storage Quota Issue</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/02-actions/20251018-issue-github-action-fails-with-artifact-storage-quota-has-been-hit/03-solution_summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary - GitHub Actions Artifact Storage Quota Issue</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/02-actions/20251018-issue-github-action-fails-with-artifact-storage-quota-has-been-hit/05-final_solution_no_artifacts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FINAL SOLUTION: No Artifacts Approach</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.01-github/02-actions/20251018-issue-github-action-fails-with-artifact-storage-quota-has-been-hit/99-wsl_error_fix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">WSL Error Fix - Updated Solution</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="true"><i class="bi bi-chat-dots" role="img">
</i> 
 <span class="menu-text">Prompt Engineering</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-22" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/02.00-how_to_name_and_organize_prompt_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Name and Organize Prompt Files in Your GitHub Repository</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/03.00-how_to_structure_content_for_copilot_prompt_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Structure Content for GitHub Copilot Prompt Files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/04.00-how_to_structure_content_for_copilot_agent_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Structure Content for GitHub Copilot Agent Files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/05.00-how_to_structure_content_for_copilot_instruction_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Structure Content for GitHub Copilot Instruction Files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/06.00-how_to_structure_content_for_copilot_skills.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Structure Content for GitHub Copilot Skills</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/07.00-how_to_create_mcp_servers_for_copilot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Create MCP Servers for GitHub Copilot</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/08.00-how_to_optimize_prompts_for_specific_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Optimize Prompts for Specific Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/08.01-appendix_openai_prompting_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 01: OpenAI Models Prompting Guide Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/08.02-appendix_anthropic_prompting_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 02: Anthropic Claude Prompting Guide Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/08.03-appendix_google_prompting_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 03: Google Gemini Prompting Guide Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/09.00-how_to_manage_information_flow_during_prompt_orchestrations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Manage Information Flow During Prompt Orchestrations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/10.00-how_to_optimize_token_consumption_during_prompt_orchestrations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">How to Optimize Token Consumption During Prompt Orchestrations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/20-how_to_create_a_prompt_interacting_with_agents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Create a Prompt Orchestrating Multiple Agents</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/21.1-example_prompt_interacting_with_agents_plan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multi-Agent Orchestration Plan V2 for Prompt and Agent File Creation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/22-prompts-and-markdown-structure-for-a-documentation-site.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prompts and Markdown Structure for a Documentation Site</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false">
 <span class="menu-text">02 Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-23" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/05.02-prompt-engineering/02-getting-started/01.00-how_github_copilot_uses_markdown_and_prompt_folders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How GitHub Copilot Uses Markdown and Prompt Folders within Your Repo</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="true"><i class="bi bi-plug" role="img">
</i> 
 <span class="menu-text">HTTP Client</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-24" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false">
 <span class="menu-text">20250711 Use Http Files for Easy and Repeatable Test</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-25" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/10.01-httpclient/20250711-use-http-files-for-easy-and-repeatable-test/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Readme</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false">
 <span class="menu-text">20250713 Use Http Files for Easy and Repeatable Test</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-26" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/10.01-httpclient/20250713-use-http-files-for-easy-and-repeatable-test/00-http-rest-api-testing-tools-comprehensive-comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üîç HTTP/REST API Testing Tools - Comprehensive Comparison</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/10.01-httpclient/20250713-use-http-files-for-easy-and-repeatable-test/02-using-http-files-for-api-testing-(visual-studio).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using HTTP Files for API Testing (Visual Studio)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/10.01-httpclient/20250713-use-http-files-for-easy-and-repeatable-test/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Readme</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="true"><i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Markdown Compilers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-27" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false"><i class="bi bi-file-richtext" role="img">
</i> 
 <span class="menu-text">Quarto</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-28" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/01.01-introduction-to-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/01.02-how-quarto-works.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Quarto Works</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/02.01-monolithic-vs-modular-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monolithic vs.&nbsp;Modular Deployment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/02.02-split-navigation-build.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Split Navigation Build from Content Rendering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/03.01-quarto-yml-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">_quarto.yml Document Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/04.01-markdown-features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto-Specific Markdown Features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/05.01-theming-and-styling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Theming and Styling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/06.01-sidebar-layout.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How does quarto site layout works</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/06.02-navigation-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Navbars Navigation Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/06.03-transition-optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sidebar Page Transition Optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/07.01-build-optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimizing Quarto Build and Deploy Performance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/08.01-troubleshooting-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting Quarto Sites</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/09.01-github-pages-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deploying a Quarto Site to GitHub Pages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/09.02-azure-storage-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deploying a Quarto Site to Azure Storage Accounts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/10.01-customizing-markdown-rendering-with-lua-filters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customizing Markdown Rendering with Lua Filters</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/01-quarto/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Documentation Series</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false"><i class="bi bi-book-half" role="img">
</i> 
 <span class="menu-text">MkDocs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-29" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/02-mkdocs/000.000-using-mkdocs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using MkDocs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/02-mkdocs/001.001-architecture-how-mkdocs-works.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MkDocs Architecture - How MkDocs Works</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/02-mkdocs/001.002-architecture-monolithic-vs.-modular-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MkDocs Architecture - Monolithic vs.&nbsp;Modular Deployment</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false"><i class="bi bi-lightning-charge" role="img">
</i> 
 <span class="menu-text">Hugo</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-30" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/03-hugo/01.01-introduction-to-hugo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Hugo Static Site Generator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/03-hugo/01.02-hugo-core-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hugo Core Concepts: Content Organization and Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/03-hugo/01.03-goldmark-markdown-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Goldmark Markdown Processing in Hugo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/03-hugo/01.04-hugo-vs-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hugo vs Quarto: Comprehensive Comparison for Learning Hub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/03-hugo/05.03-rendering-learning-hub-with-hugo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rendering Learning Hub with Hugo: Practical Implementation Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/20.01-markdown/03-hugo/readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hugo Static Site Generator Series</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="true"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text">Feed Architectures &amp; Protocols</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-31" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false">
 <span class="menu-text">20251005 Feeds Architectures and Protocols</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-32" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/01-podcast-and-rss-feed-information-gathering-and-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Podcast and RSS Feed: Information Gathering and Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/02-analyzing-atom-and-rss-specifications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzing Atom and RSS Specifications</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/03-additional-metadata-for-rss-and-atom-feeds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Additional Metadata for RSS and Atom Feeds</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/21.01-feed/20251005-feeds-architectures-and-protocols/04-c#-reference-classes-for-reading-feeds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">C# Reference Classes for Reading RSS and Atom Feeds</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="true"><i class="bi bi-cpu-fill" role="img">
</i> 
 <span class="menu-text">Hardware</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-33" class="collapse list-unstyled sidebar-section depth2 show">  
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="true"><i class="bi bi-pencil-square" role="img">
</i> 
 <span class="menu-text">Technical Writing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-34" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/00-foundations-of-technical-documentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations &amp; Principles</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/01-writing-style-and-voice-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing Style &amp; Voice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/02-structure-and-information-architecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure &amp; Architecture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/03-accessibility-in-technical-writing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accessibility</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/04-code-documentation-excellence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code Documentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/05-validation-and-quality-assurance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validation &amp; QA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/06-citations-and-reference-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citations &amp; References</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/07-ai-enhanced-documentation-writing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI-Enhanced Writing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false"><i class="bi bi-microsoft" role="img">
</i> 
 <span class="menu-text">microsoft-writing-style-guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-35" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/microsoft-writing-style-guide/00-microsoft-style-guide-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview &amp; Philosophy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/microsoft-writing-style-guide/01-microsoft-voice-and-tone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Voice &amp; Tone</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/microsoft-writing-style-guide/02-microsoft-mechanics-and-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mechanics &amp; Formatting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/microsoft-writing-style-guide/03-microsoft-compared-to-other-guides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Comparative Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../03.00-tech/40.00-technical-writing/microsoft-writing-style-guide/04-microsoft-style-principles-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Principles Reference (YAML/JSON)</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="true"><i class="bi bi-tools" role="img">
</i> 
 <span class="menu-text">How-To Guides</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-36" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../04.00-howto/20251108-howto-configure-promot-files-for-markdown-preview-in-visual-studio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HowTo: Configure .prompt Files for Markdown Preview in Visual Studio</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="true">
 <span class="menu-text">20251013 Howto Expose My Computer with No Ip Ddns</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-37" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../04.00-howto/20251013-howto-expose-my-computer-with-no-ip-ddns/howto.expose-my-computer-with-no-ip-ddns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üåê HowTo: Expose My Computer with No-IP DDNS</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="true"><i class="bi bi-lightbulb" role="img">
</i> 
 <span class="menu-text">Ideas &amp; Projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-38" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-39" role="navigation" aria-expanded="true"><i class="bi bi-book-half" role="img">
</i> 
 <span class="menu-text">Learning Hub</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-39" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-39" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-40" role="navigation" aria-expanded="false">
 <span class="menu-text">01 Learning Hub Overview</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-40" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-40" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../06.00-idea/learning-hub/01-learning-hub-overview/01-learning-hub-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learning Hub Concept</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../06.00-idea/learning-hub/01-learning-hub-overview/02-using-learning-hub-for-learning-technologies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Learning Hub for Learning Technologies</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-41" role="navigation" aria-expanded="false">
 <span class="menu-text">02 Documentation Taxonomy</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-41" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-41" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../06.00-idea/learning-hub/02-documentation-taxonomy/01-learning-hub-documentation-taxonomy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learning-hub Documentation Taxonomy</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#how-to-optimize-token-consumption-during-prompt-orchestrations" id="toc-how-to-optimize-token-consumption-during-prompt-orchestrations" class="nav-link active" data-scroll-target="#how-to-optimize-token-consumption-during-prompt-orchestrations">How to Optimize Token Consumption During Prompt Orchestrations</a>
  <ul class="collapse">
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  </ul></li>
  <li><a href="#why-token-optimization-matters" id="toc-why-token-optimization-matters" class="nav-link" data-scroll-target="#why-token-optimization-matters">üéØ Why token optimization matters</a>
  <ul class="collapse">
  <li><a href="#the-cost-equation" id="toc-the-cost-equation" class="nav-link" data-scroll-target="#the-cost-equation">The cost equation</a>
  <ul class="collapse">
  <li><a href="#the-multiplication-problem" id="toc-the-multiplication-problem" class="nav-link" data-scroll-target="#the-multiplication-problem">The multiplication problem</a></li>
  <li><a href="#real-world-cost-impact" id="toc-real-world-cost-impact" class="nav-link" data-scroll-target="#real-world-cost-impact">Real-world cost impact</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#token-consumption-anatomy" id="toc-token-consumption-anatomy" class="nav-link" data-scroll-target="#token-consumption-anatomy">üìä Token consumption anatomy</a>
  <ul class="collapse">
  <li><a href="#optimization-opportunities-by-category" id="toc-optimization-opportunities-by-category" class="nav-link" data-scroll-target="#optimization-opportunities-by-category">Optimization opportunities by category</a></li>
  </ul></li>
  <li><a href="#strategy-1-context-reduction" id="toc-strategy-1-context-reduction" class="nav-link" data-scroll-target="#strategy-1-context-reduction">‚úÇÔ∏è Strategy 1: Context reduction</a>
  <ul class="collapse">
  <li><a href="#technique-1.1-targeted-file-reads" id="toc-technique-1.1-targeted-file-reads" class="nav-link" data-scroll-target="#technique-1.1-targeted-file-reads">Technique 1.1: Targeted file reads</a>
  <ul class="collapse">
  <li><a href="#token-savings-example" id="toc-token-savings-example" class="nav-link" data-scroll-target="#token-savings-example">Token savings example</a></li>
  </ul></li>
  <li><a href="#technique-1.2-search-result-limiting" id="toc-technique-1.2-search-result-limiting" class="nav-link" data-scroll-target="#technique-1.2-search-result-limiting">Technique 1.2: Search result limiting</a></li>
  <li><a href="#technique-1.3-progressive-summarization" id="toc-technique-1.3-progressive-summarization" class="nav-link" data-scroll-target="#technique-1.3-progressive-summarization">Technique 1.3: Progressive summarization</a>
  <ul class="collapse">
  <li><a href="#token-savings-from-summarization" id="toc-token-savings-from-summarization" class="nav-link" data-scroll-target="#token-savings-from-summarization">Token savings from summarization</a></li>
  </ul></li>
  <li><a href="#technique-1.4-instruction-file-pruning" id="toc-technique-1.4-instruction-file-pruning" class="nav-link" data-scroll-target="#technique-1.4-instruction-file-pruning">Technique 1.4: Instruction file pruning</a></li>
  </ul></li>
  <li><a href="#strategy-2-provider-prompt-caching" id="toc-strategy-2-provider-prompt-caching" class="nav-link" data-scroll-target="#strategy-2-provider-prompt-caching">üíæ Strategy 2: Provider prompt caching</a>
  <ul class="collapse">
  <li><a href="#how-provider-caching-works" id="toc-how-provider-caching-works" class="nav-link" data-scroll-target="#how-provider-caching-works">How provider caching works</a></li>
  <li><a href="#provider-comparison" id="toc-provider-comparison" class="nav-link" data-scroll-target="#provider-comparison">Provider comparison</a></li>
  <li><a href="#optimization-structure-prompts-for-caching" id="toc-optimization-structure-prompts-for-caching" class="nav-link" data-scroll-target="#optimization-structure-prompts-for-caching">Optimization: Structure prompts for caching</a>
  <ul class="collapse">
  <li><a href="#token-savings-from-provider-caching" id="toc-token-savings-from-provider-caching" class="nav-link" data-scroll-target="#token-savings-from-provider-caching">Token savings from provider caching</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#strategy-3-semantic-caching" id="toc-strategy-3-semantic-caching" class="nav-link" data-scroll-target="#strategy-3-semantic-caching">üß† Strategy 3: Semantic caching</a>
  <ul class="collapse">
  <li><a href="#how-semantic-caching-works" id="toc-how-semantic-caching-works" class="nav-link" data-scroll-target="#how-semantic-caching-works">How semantic caching works</a></li>
  <li><a href="#implementation-gptcache" id="toc-implementation-gptcache" class="nav-link" data-scroll-target="#implementation-gptcache">Implementation: GPTCache</a></li>
  <li><a href="#when-semantic-caching-helps-vs.-hurts" id="toc-when-semantic-caching-helps-vs.-hurts" class="nav-link" data-scroll-target="#when-semantic-caching-helps-vs.-hurts">When semantic caching helps vs.&nbsp;hurts</a></li>
  </ul></li>
  <li><a href="#strategy-4-model-selection" id="toc-strategy-4-model-selection" class="nav-link" data-scroll-target="#strategy-4-model-selection">üéöÔ∏è Strategy 4: Model selection</a>
  <ul class="collapse">
  <li><a href="#the-model-selection-principle" id="toc-the-model-selection-principle" class="nav-link" data-scroll-target="#the-model-selection-principle">The model selection principle</a></li>
  <li><a href="#when-to-use-which-model-size" id="toc-when-to-use-which-model-size" class="nav-link" data-scroll-target="#when-to-use-which-model-size">When to use which model size</a></li>
  <li><a href="#implementation-task-routing" id="toc-implementation-task-routing" class="nav-link" data-scroll-target="#implementation-task-routing">Implementation: Task routing</a></li>
  <li><a href="#practical-example-split-prompt-by-complexity" id="toc-practical-example-split-prompt-by-complexity" class="nav-link" data-scroll-target="#practical-example-split-prompt-by-complexity">Practical example: Split prompt by complexity</a>
  <ul class="collapse">
  <li><a href="#token-savings-from-model-selection" id="toc-token-savings-from-model-selection" class="nav-link" data-scroll-target="#token-savings-from-model-selection">Token savings from model selection</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#strategy-5-batch-processing" id="toc-strategy-5-batch-processing" class="nav-link" data-scroll-target="#strategy-5-batch-processing">üì¶ Strategy 5: Batch processing</a>
  <ul class="collapse">
  <li><a href="#when-to-use-batch-processing" id="toc-when-to-use-batch-processing" class="nav-link" data-scroll-target="#when-to-use-batch-processing">When to use batch processing</a></li>
  <li><a href="#provider-batch-apis" id="toc-provider-batch-apis" class="nav-link" data-scroll-target="#provider-batch-apis">Provider batch APIs</a></li>
  <li><a href="#implementation-example-anthropic" id="toc-implementation-example-anthropic" class="nav-link" data-scroll-target="#implementation-example-anthropic">Implementation example (Anthropic)</a></li>
  <li><a href="#combining-batch-processing-with-prompt-caching" id="toc-combining-batch-processing-with-prompt-caching" class="nav-link" data-scroll-target="#combining-batch-processing-with-prompt-caching">Combining batch processing with prompt caching</a>
  <ul class="collapse">
  <li><a href="#token-savings-from-batch-processing" id="toc-token-savings-from-batch-processing" class="nav-link" data-scroll-target="#token-savings-from-batch-processing">Token savings from batch processing</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#strategy-6-request-consolidation" id="toc-strategy-6-request-consolidation" class="nav-link" data-scroll-target="#strategy-6-request-consolidation">üîó Strategy 6: Request consolidation</a>
  <ul class="collapse">
  <li><a href="#the-consolidation-principle" id="toc-the-consolidation-principle" class="nav-link" data-scroll-target="#the-consolidation-principle">The consolidation principle</a></li>
  <li><a href="#before-vs.-after-consolidation" id="toc-before-vs.-after-consolidation" class="nav-link" data-scroll-target="#before-vs.-after-consolidation">Before vs.&nbsp;After consolidation</a></li>
  <li><a href="#implementation-pattern" id="toc-implementation-pattern" class="nav-link" data-scroll-target="#implementation-pattern">Implementation pattern</a>
  <ul class="collapse">
  <li><a href="#technique-7.2-shortened-json-field-names" id="toc-technique-7.2-shortened-json-field-names" class="nav-link" data-scroll-target="#technique-7.2-shortened-json-field-names">Technique 7.2: Shortened JSON field names</a></li>
  <li><a href="#technique-7.3-use-max_tokens-and-stop_tokens" id="toc-technique-7.3-use-max_tokens-and-stop_tokens" class="nav-link" data-scroll-target="#technique-7.3-use-max_tokens-and-stop_tokens">Technique 7.3: Use <code>max_tokens</code> and <code>stop_tokens</code></a></li>
  <li><a href="#token-savings-from-output-reduction" id="toc-token-savings-from-output-reduction" class="nav-link" data-scroll-target="#token-savings-from-output-reduction">Token savings from output reduction</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#strategy-8-deterministic-tools" id="toc-strategy-8-deterministic-tools" class="nav-link" data-scroll-target="#strategy-8-deterministic-tools">‚öôÔ∏è Strategy 8: Deterministic tools</a>
  <ul class="collapse">
  <li><a href="#when-to-use-deterministic-tools" id="toc-when-to-use-deterministic-tools" class="nav-link" data-scroll-target="#when-to-use-deterministic-tools">When to use deterministic tools</a></li>
  <li><a href="#implementation-mcp-server-with-deterministic-tools" id="toc-implementation-mcp-server-with-deterministic-tools" class="nav-link" data-scroll-target="#implementation-mcp-server-with-deterministic-tools">Implementation: MCP server with deterministic tools</a>
  <ul class="collapse">
  <li><a href="#token-savings-from-deterministic-cache-checks" id="toc-token-savings-from-deterministic-cache-checks" class="nav-link" data-scroll-target="#token-savings-from-deterministic-cache-checks">Token savings from deterministic cache checks</a></li>
  </ul></li>
  <li><a href="#common-deterministic-operations-to-implement" id="toc-common-deterministic-operations-to-implement" class="nav-link" data-scroll-target="#common-deterministic-operations-to-implement">Common deterministic operations to implement</a></li>
  </ul></li>
  <li><a href="#strategy-9-streaming-and-parallelization" id="toc-strategy-9-streaming-and-parallelization" class="nav-link" data-scroll-target="#strategy-9-streaming-and-parallelization">‚ö° Strategy 9: Streaming and parallelization</a>
  <ul class="collapse">
  <li><a href="#streaming-progressive-output-delivery" id="toc-streaming-progressive-output-delivery" class="nav-link" data-scroll-target="#streaming-progressive-output-delivery">Streaming: Progressive output delivery</a>
  <ul class="collapse">
  <li><a href="#when-to-use-streaming" id="toc-when-to-use-streaming" class="nav-link" data-scroll-target="#when-to-use-streaming">When to use streaming</a></li>
  </ul></li>
  <li><a href="#parallelization-concurrent-independent-tasks" id="toc-parallelization-concurrent-independent-tasks" class="nav-link" data-scroll-target="#parallelization-concurrent-independent-tasks">Parallelization: Concurrent independent tasks</a>
  <ul class="collapse">
  <li><a href="#implementation-parallel-validation" id="toc-implementation-parallel-validation" class="nav-link" data-scroll-target="#implementation-parallel-validation">Implementation: Parallel validation</a></li>
  </ul></li>
  <li><a href="#speculative-execution-predicted-outputs" id="toc-speculative-execution-predicted-outputs" class="nav-link" data-scroll-target="#speculative-execution-predicted-outputs">Speculative execution: Predicted outputs</a>
  <ul class="collapse">
  <li><a href="#when-speculative-execution-helps" id="toc-when-speculative-execution-helps" class="nav-link" data-scroll-target="#when-speculative-execution-helps">When speculative execution helps</a></li>
  </ul></li>
  <li><a href="#combined-latency-optimization" id="toc-combined-latency-optimization" class="nav-link" data-scroll-target="#combined-latency-optimization">Combined latency optimization</a></li>
  </ul></li>
  <li><a href="#strategy-comparison-matrix" id="toc-strategy-comparison-matrix" class="nav-link" data-scroll-target="#strategy-comparison-matrix">üìà Strategy comparison matrix</a>
  <ul class="collapse">
  <li><a href="#strategy-selection-flowchart" id="toc-strategy-selection-flowchart" class="nav-link" data-scroll-target="#strategy-selection-flowchart">Strategy selection flowchart</a></li>
  <li><a href="#combined-optimization-example" id="toc-combined-optimization-example" class="nav-link" data-scroll-target="#combined-optimization-example">Combined optimization example</a></li>
  </ul></li>
  <li><a href="#implementation-patterns" id="toc-implementation-patterns" class="nav-link" data-scroll-target="#implementation-patterns">üîß Implementation patterns</a>
  <ul class="collapse">
  <li><a href="#pattern-1-validation-pipeline-with-caching" id="toc-pattern-1-validation-pipeline-with-caching" class="nav-link" data-scroll-target="#pattern-1-validation-pipeline-with-caching">Pattern 1: Validation pipeline with caching</a></li>
  <li><a href="#pattern-2-research-with-semantic-caching" id="toc-pattern-2-research-with-semantic-caching" class="nav-link" data-scroll-target="#pattern-2-research-with-semantic-caching">Pattern 2: Research with semantic caching</a></li>
  <li><a href="#pattern-3-progressive-summarization-handoff" id="toc-pattern-3-progressive-summarization-handoff" class="nav-link" data-scroll-target="#pattern-3-progressive-summarization-handoff">Pattern 3: Progressive summarization handoff</a></li>
  </ul></li>
  <li><a href="#common-pitfalls" id="toc-common-pitfalls" class="nav-link" data-scroll-target="#common-pitfalls">‚ö†Ô∏è Common pitfalls</a>
  <ul class="collapse">
  <li><a href="#pitfall-1-over-caching-dynamic-content" id="toc-pitfall-1-over-caching-dynamic-content" class="nav-link" data-scroll-target="#pitfall-1-over-caching-dynamic-content">Pitfall 1: Over-caching dynamic content</a></li>
  <li><a href="#pitfall-2-cache-key-collisions" id="toc-pitfall-2-cache-key-collisions" class="nav-link" data-scroll-target="#pitfall-2-cache-key-collisions">Pitfall 2: Cache key collisions</a></li>
  <li><a href="#pitfall-3-ignoring-cache-write-costs" id="toc-pitfall-3-ignoring-cache-write-costs" class="nav-link" data-scroll-target="#pitfall-3-ignoring-cache-write-costs">Pitfall 3: Ignoring cache write costs</a></li>
  <li><a href="#pitfall-4-placing-dynamic-content-before-static" id="toc-pitfall-4-placing-dynamic-content-before-static" class="nav-link" data-scroll-target="#pitfall-4-placing-dynamic-content-before-static">Pitfall 4: Placing dynamic content before static</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">üéØ Conclusion</a>
  <ul class="collapse">
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key takeaways</a></li>
  <li><a href="#implementation-priority" id="toc-implementation-priority" class="nav-link" data-scroll-target="#implementation-priority">Implementation priority</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next steps</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">üìö References</a>
  <ul class="collapse">
  <li><a href="#official-documentation" id="toc-official-documentation" class="nav-link" data-scroll-target="#official-documentation">Official Documentation</a></li>
  <li><a href="#community-resources" id="toc-community-resources" class="nav-link" data-scroll-target="#community-resources">Community Resources</a></li>
  <li><a href="#internal-references" id="toc-internal-references" class="nav-link" data-scroll-target="#internal-references">Internal References</a></li>
  <li><a href="#series-navigation" id="toc-series-navigation" class="nav-link" data-scroll-target="#series-navigation">Series Navigation</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/darioairoldi/Learn/edit/main/03.00-tech/05.02-prompt-engineering/10.00-how_to_optimize_token_consumption_during_prompt_orchestrations.md" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/darioairoldi/Learn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Technologies</li><li class="breadcrumb-item"><a href="../../03.00-tech/05.02-prompt-engineering/02.00-how_to_name_and_organize_prompt_files.html">Prompt Engineering</a></li><li class="breadcrumb-item"><a href="../../03.00-tech/05.02-prompt-engineering/10.00-how_to_optimize_token_consumption_during_prompt_orchestrations.html">How to Optimize Token Consumption During Prompt Orchestrations</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">How to Optimize Token Consumption During Prompt Orchestrations</h1>
  <div class="quarto-categories">
    <div class="quarto-category">tech</div>
    <div class="quarto-category">github-copilot</div>
    <div class="quarto-category">prompt-engineering</div>
    <div class="quarto-category">optimization</div>
    <div class="quarto-category">token-efficiency</div>
  </div>
  </div>

<div>
  <div class="description">
    Master token optimization strategies for multi-agent workflows: context reduction, deterministic tools, semantic caching, and provider caching to reduce costs by up to 90%
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dario Airoldi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 25, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="how-to-optimize-token-consumption-during-prompt-orchestrations" class="level1">
<h1>How to Optimize Token Consumption During Prompt Orchestrations</h1>
<p>Token consumption is <mark><strong>the hidden cost driver</strong></mark> in complex AI workflows.<br>
While the previous article explored <em>how</em> information flows between prompts, agents, and tools, this article focuses on <em>minimizing</em> the tokens consumed during that flow‚Äîdirectly reducing costs, latency, and context window pressure.</p>
<p>You‚Äôll learn <strong>nine distinct optimization strategies</strong> organized into three categories that can be combined for maximum effect:</p>
<p><strong>Input Optimization:</strong></p>
<ol type="1">
<li><strong>Context reduction</strong> ‚Äî Minimizing what enters the context window</li>
<li><strong>Provider prompt caching</strong> ‚Äî Leveraging built-in provider caching mechanisms</li>
<li><strong>Semantic caching</strong> ‚Äî Reusing results for semantically similar queries</li>
</ol>
<p><strong>Processing Optimization:</strong></p>
<ol start="4" type="1">
<li><strong>Model selection</strong> ‚Äî Using smaller models for simpler tasks</li>
<li><strong>Batch processing</strong> ‚Äî Async processing with 50% cost discount</li>
<li><strong>Request consolidation</strong> ‚Äî Combining sequential steps into single requests</li>
</ol>
<p><strong>Output Optimization:</strong></p>
<ol start="7" type="1">
<li><strong>Output token reduction</strong> ‚Äî Generating fewer tokens</li>
<li><strong>Deterministic tools</strong> ‚Äî Bypassing AI entirely for predictable operations</li>
<li><strong>Streaming and parallelization</strong> ‚Äî Reducing perceived latency and enabling speculative execution</li>
</ol>
<p>By applying these strategies, you can achieve <mark><strong>50-90% cost reduction</strong></mark> while maintaining or improving response quality.</p>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#-why-token-optimization-matters">üéØ Why token optimization matters</a></li>
<li><a href="#-token-consumption-anatomy">üìä Token consumption anatomy</a></li>
<li><a href="#Ô∏è-strategy-1-context-reduction">‚úÇÔ∏è Strategy 1: Context reduction</a></li>
<li><a href="#-strategy-2-provider-prompt-caching">üíæ Strategy 2: Provider prompt caching</a></li>
<li><a href="#-strategy-3-semantic-caching">üß† Strategy 3: Semantic caching</a></li>
<li><a href="#Ô∏è-strategy-4-model-selection">üéöÔ∏è Strategy 4: Model selection</a></li>
<li><a href="#-strategy-5-batch-processing">üì¶ Strategy 5: Batch processing</a></li>
<li><a href="#-strategy-6-request-consolidation">üîó Strategy 6: Request consolidation</a></li>
<li><a href="#-strategy-7-output-token-reduction">üìâ Strategy 7: Output token reduction</a></li>
<li><a href="#Ô∏è-strategy-8-deterministic-tools">‚öôÔ∏è Strategy 8: Deterministic tools</a></li>
<li><a href="#-strategy-9-streaming-and-parallelization">‚ö° Strategy 9: Streaming and parallelization</a></li>
<li><a href="#-strategy-comparison-matrix">üìà Strategy comparison matrix</a></li>
<li><a href="#-implementation-patterns">üîß Implementation patterns</a></li>
<li><a href="#Ô∏è-common-pitfalls">‚ö†Ô∏è Common pitfalls</a></li>
<li><a href="#-conclusion">üéØ Conclusion</a></li>
<li><a href="#-references">üìö References</a></li>
</ul>
<hr>
</section>
</section>
<section id="why-token-optimization-matters" class="level1">
<h1>üéØ Why token optimization matters</h1>
<section id="the-cost-equation" class="level2">
<h2 class="anchored" data-anchor-id="the-cost-equation">The cost equation</h2>
<p>Every interaction with an AI model consumes tokens from three sources:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Source</th>
<th>Description</th>
<th>Cost Impact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><mark>Input tokens</mark></strong></td>
<td>Context window content (prompts, instructions, context)</td>
<td><mark>Paid per request</mark></td>
</tr>
<tr class="even">
<td><strong><mark>Output tokens</mark></strong></td>
<td>Model-generated response</td>
<td><mark>Paid per request (typically 3-5√ó input cost)</mark></td>
</tr>
<tr class="odd">
<td><strong><mark>Reasoning tokens</mark></strong></td>
<td>Internal reasoning (o3, o4-mini, extended thinking)</td>
<td><mark>Hidden cost, often 10-50√ó visible output</mark></td>
</tr>
</tbody>
</table>
<section id="the-multiplication-problem" class="level3">
<h3 class="anchored" data-anchor-id="the-multiplication-problem">The multiplication problem</h3>
<p>In multi-agent orchestrations, token consumption isn‚Äôt additive‚Äîit‚Äôs <mark><strong>multiplicative</strong></mark>:</p>
<pre><code>Single request:     1,000 input + 500 output = 1,500 tokens

5-phase workflow with full context transfer:
‚îú‚îÄ‚îÄ Phase 1:  1,000 + 500 = 1,500 tokens
‚îú‚îÄ‚îÄ Phase 2:  1,500 + 800 = 2,300 tokens (inherited context)
‚îú‚îÄ‚îÄ Phase 3:  2,300 + 600 = 2,900 tokens
‚îú‚îÄ‚îÄ Phase 4:  2,900 + 700 = 3,600 tokens
‚îú‚îÄ‚îÄ Phase 5:  3,600 + 400 = 4,000 tokens
‚îÇ
‚îî‚îÄ‚îÄ TOTAL: 14,300 tokens (9.5√ó single request)</code></pre>
<p>Without optimization, a 5-phase workflow consumes nearly <mark><strong>10√ó the tokens</strong></mark> of a single interaction.</p>
</section>
<section id="real-world-cost-impact" class="level3">
<h3 class="anchored" data-anchor-id="real-world-cost-impact">Real-world cost impact</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 30%">
<col style="width: 25%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Scenario</th>
<th>Unoptimized</th>
<th>Optimized</th>
<th>Savings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Simple 3-phase workflow</td>
<td>~8,000 tokens</td>
<td>~3,000 tokens</td>
<td>62%</td>
</tr>
<tr class="even">
<td>Complex 6-phase orchestration</td>
<td>~45,000 tokens</td>
<td>~12,000 tokens</td>
<td>73%</td>
</tr>
<tr class="odd">
<td>Validation pipeline (10 articles)</td>
<td>~200,000 tokens</td>
<td>~40,000 tokens</td>
<td>80%</td>
</tr>
<tr class="even">
<td>Daily development workflow</td>
<td>~500,000 tokens</td>
<td>~100,000 tokens</td>
<td>80%</td>
</tr>
</tbody>
</table>
<p>At typical API pricing, 80% savings translates to substantial cost reduction over time.</p>
<hr>
</section>
</section>
</section>
<section id="token-consumption-anatomy" class="level1">
<h1>üìä Token consumption anatomy</h1>
<p>Before optimizing, understand <mark>where tokens are consumed</mark> in a typical prompt orchestration:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CONTEXT WINDOW BREAKDOWN                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  SYSTEM CONTEXT (~2,000-5,000 tokens)                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Agent definition (.agent.md)          ~800-1,500 tokens     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Instructions (.instructions.md)       ~500-2,000 tokens     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ Global instructions (copilot-instructions.md) ~500-1,000    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  USER CONTEXT (~500-10,000 tokens)                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Prompt file content                   ~300-2,000 tokens     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Included snippets (#file:...)         ~200-2,000 tokens     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ User message                          ~50-500 tokens        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ Handoff context (from previous agent) ~0-5,000 tokens       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  TOOL RESULTS (~0-50,000 tokens)                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ File reads (read_file)                ~500-5,000 each       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Search results (semantic_search)      ~1,000-3,000          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Web fetches (fetch_webpage)           ~3,000-15,000         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ MCP tool results                      ~500-10,000           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  CONVERSATION HISTORY (~0-100,000 tokens)                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ Prior turns in multi-turn conversation                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
<section id="optimization-opportunities-by-category" class="level3">
<h3 class="anchored" data-anchor-id="optimization-opportunities-by-category">Optimization opportunities by category</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 39%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Category</th>
<th>Typical % of Context</th>
<th>Optimization Strategy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>System context</td>
<td>5-15%</td>
<td>Instruction file pruning, agent streamlining</td>
</tr>
<tr class="even">
<td>User context</td>
<td>5-20%</td>
<td>Prompt compression, snippet elimination</td>
</tr>
<tr class="odd">
<td>Tool results</td>
<td>20-60%</td>
<td><mark><strong>Targeted reads, result limits, deterministic tools</strong></mark></td>
</tr>
<tr class="even">
<td>Conversation history</td>
<td>10-50%</td>
<td><mark><strong>Progressive summarization, file-based isolation</strong></mark></td>
</tr>
</tbody>
</table>
<p><mark><strong>Key insight</strong></mark>: Tool results and conversation history are the biggest optimization targets. Focus there first.</p>
<hr>
</section>
</section>
<section id="strategy-1-context-reduction" class="level1">
<h1>‚úÇÔ∏è Strategy 1: Context reduction</h1>
<p><mark><strong>Context reduction</strong></mark> minimizes what enters the context window in the first place‚Äîthe most direct path to token savings.</p>
<section id="technique-1.1-targeted-file-reads" class="level2">
<h2 class="anchored" data-anchor-id="technique-1.1-targeted-file-reads">Technique 1.1: Targeted file reads</h2>
<p>‚ùå <strong>Wasteful pattern</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Read the entire file for context.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This often results in reading 500+ lines when only 20 lines are relevant.</p>
<p>‚úÖ <strong>Efficient pattern</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Read lines 45-65 of the configuration file where the validation logic is defined.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Implementation in prompt files</strong>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> targeted-review</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Review specific section with minimal context"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tools</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'read_file'</span><span class="kw">]</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Process</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">1. Read ONLY the specific section</span><span class="kw">:</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">For class definitions</span><span class="kw">:</span><span class="at"> read class header + target method (20-50 lines)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">For configuration</span><span class="kw">:</span><span class="at"> read only relevant section</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> Use grep_search first to identify exact line ranges</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">2. **NEVER read entire files unless explicitly required**</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="token-savings-example" class="level3">
<h3 class="anchored" data-anchor-id="token-savings-example">Token savings example</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 47%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Approach</th>
<th>Tokens Consumed</th>
<th>Savings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Read entire 500-line file</td>
<td>~5,000 tokens</td>
<td>‚Äî</td>
</tr>
<tr class="even">
<td>Read targeted 50 lines</td>
<td>~500 tokens</td>
<td><mark><strong>90%</strong></mark></td>
</tr>
<tr class="odd">
<td>Use grep to find, then read 20 lines</td>
<td>~200 tokens</td>
<td><mark><strong>96%</strong></mark></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="technique-1.2-search-result-limiting" class="level2">
<h2 class="anchored" data-anchor-id="technique-1.2-search-result-limiting">Technique 1.2: Search result limiting</h2>
<p>‚ùå <strong>Wasteful pattern</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Search the codebase for validation patterns.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This can return 20+ results, each consuming hundreds of tokens.</p>
<p>‚úÖ <strong>Efficient pattern</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Search for validation patterns, limit to 3 most relevant results.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>In prompts</strong>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tools</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'semantic_search'</span><span class="kw">,</span><span class="at"> </span><span class="st">'grep_search'</span><span class="kw">]</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Tool Usage Guidelines</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">When searching</span><span class="kw">:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">1. **Use grep_search first** for known patterns (cheaper, faster)</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">2. **Limit semantic_search results** to 3-5 maximum</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">3. **Be specific in queries** ‚Äî "authentication middleware" not "middleware"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="technique-1.3-progressive-summarization" class="level2">
<h2 class="anchored" data-anchor-id="technique-1.3-progressive-summarization">Technique 1.3: Progressive summarization</h2>
<p>Instead of passing full conversation history between phases, <mark>compress it to essential data</mark>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## Phase Completion Template</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>When completing this phase, produce a **PHASE SUMMARY** (max 200 tokens):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phase {N} Summary</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>**Decisions Made**:</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Decision 1</span><span class="co">]</span>: <span class="co">[</span><span class="ot">Rationale</span><span class="co">]</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Decision 2</span><span class="co">]</span>: <span class="co">[</span><span class="ot">Rationale</span><span class="co">]</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>**Critical Outputs**:</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Output file/artifact</span><span class="co">]</span>: <span class="co">[</span><span class="ot">1-line description</span><span class="co">]</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>**For Next Phase**:</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Specific instruction for successor</span><span class="co">]</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Full details are in: [file reference] --&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="token-savings-from-summarization" class="level3">
<h3 class="anchored" data-anchor-id="token-savings-from-summarization">Token savings from summarization</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Handoff Method</th>
<th>Tokens per Handoff</th>
<th>5-Phase Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Full context (<code>send: true</code>)</td>
<td>~3,000 tokens</td>
<td>~15,000 tokens</td>
</tr>
<tr class="even">
<td>Progressive summary</td>
<td>~300 tokens</td>
<td>~1,500 tokens</td>
</tr>
<tr class="odd">
<td><strong>Savings</strong></td>
<td></td>
<td><mark><strong>90%</strong></mark></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="technique-1.4-instruction-file-pruning" class="level2">
<h2 class="anchored" data-anchor-id="technique-1.4-instruction-file-pruning">Technique 1.4: Instruction file pruning</h2>
<p>Instructions files apply automatically based on <code>applyTo</code> patterns. <mark>Overly broad patterns waste tokens</mark>:</p>
<p>‚ùå <strong>Wasteful</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">applyTo</span><span class="kw">:</span><span class="at"> </span><span class="st">"**/*"</span><span class="co">   # Applies to EVERY file</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 200 lines of React component guidelines...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úÖ <strong>Targeted</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">applyTo</span><span class="kw">:</span><span class="at"> </span><span class="st">"**/*.tsx,**/*.jsx"</span><span class="co">   # Only React files</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Audit your instruction files</strong>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find instruction files and their patterns</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Get-ChildItem</span> <span class="op">-</span>Path <span class="st">".github/instructions"</span> <span class="op">-</span>Filter <span class="st">"*.instructions.md"</span> <span class="op">|</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ForEach-Object</span> <span class="op">{</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$content</span> <span class="op">=</span> <span class="fu">Get-Content</span> <span class="va">$_</span><span class="op">.</span><span class="fu">FullName</span> <span class="op">-</span>Raw</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="va">$content</span> <span class="op">-match</span> <span class="st">'applyTo:\s*"([^"]+)"'</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">[</span>PSCustomObject<span class="op">]</span>@<span class="op">{</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                File <span class="op">=</span> <span class="va">$_</span><span class="op">.</span><span class="fu">Name</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                Pattern <span class="op">=</span> <span class="va">$matches</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="strategy-2-provider-prompt-caching" class="level1">
<h1>üíæ Strategy 2: Provider prompt caching</h1>
<p><mark><strong>Provider prompt caching</strong></mark> is automatic caching offered by LLM providers for repeated prompt prefixes. Unlike semantic caching, it‚Äôs <mark><strong>exact-match based</strong></mark> and <mark><strong>built into the API</strong></mark>.</p>
<section id="how-provider-caching-works" class="level2">
<h2 class="anchored" data-anchor-id="how-provider-caching-works">How provider caching works</h2>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PROVIDER PROMPT CACHING                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  Request 1:                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Static Prefix (cached after 1024+ tokens)       ‚îÇ Dynamic Content  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ System instructions                           ‚îÇ ‚Ä¢ User query     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Few-shot examples                             ‚îÇ ‚Ä¢ Context        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Tool definitions                              ‚îÇ                  ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ            ‚ñ≤                                                            ‚îÇ
‚îÇ            ‚îÇ Cache write (1.25√ó base price for Anthropic)               ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Request 2 (same prefix):                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Static Prefix (CACHE HIT - 0.1√ó base price)     ‚îÇ New Dynamic      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                 ‚îÇ Content          ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  SAVINGS: 50-90% on cached prefix tokens                                ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
</section>
<section id="provider-comparison" class="level2">
<h2 class="anchored" data-anchor-id="provider-comparison">Provider comparison</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 21%">
<col style="width: 22%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Provider</th>
<th>Minimum Tokens</th>
<th>Cache Duration</th>
<th>Cache Read Cost</th>
<th>Cache Write Cost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>OpenAI</strong></td>
<td>1,024 tokens</td>
<td>5-60 min (in-memory) or 24h (extended)</td>
<td><mark><strong>50% discount</strong></mark></td>
<td>No extra cost</td>
</tr>
<tr class="even">
<td><strong>Anthropic</strong></td>
<td>1,024-4,096 tokens (model-dependent)</td>
<td>5 min default, 1h optional</td>
<td><mark><strong>90% discount</strong></mark></td>
<td>25% premium</td>
</tr>
<tr class="odd">
<td><strong>Google</strong></td>
<td>Varies</td>
<td>Context caching available</td>
<td>Reduced cost</td>
<td>Initial write cost</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p><strong>üìù Anthropic model-specific minimums:</strong></p>
<ul>
<li>Claude Sonnet 4/4.5, Opus 4/4.1: 1,024 tokens minimum</li>
<li>Claude Haiku 3.5, Opus 4.5: 4,096 tokens minimum</li>
<li>Claude Haiku 3: 2,048 tokens minimum</li>
</ul>
<p><strong>1-hour cache TTL:</strong> For agent workflows or conversations where follow-up prompts may exceed 5 minutes, use <code>"ttl": "1h"</code> in the <code>cache_control</code> block (2√ó base write price instead of 1.25√ó).</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>‚ö†Ô∏è Cache invalidation:</strong> The following changes invalidate cached content:</p>
<ul>
<li><strong>Tool definitions:</strong> Modifying names, descriptions, or parameters invalidates the entire cache</li>
<li><strong>Enabling/disabling features:</strong> Web search, citations, or thinking toggles modify system prompts</li>
<li><strong>Images:</strong> Adding or removing images anywhere in the prompt</li>
<li><strong>Content edits:</strong> Any changes to cached prefix content require re-caching</li>
</ul>
</blockquote>
</section>
<section id="optimization-structure-prompts-for-caching" class="level2">
<h2 class="anchored" data-anchor-id="optimization-structure-prompts-for-caching">Optimization: Structure prompts for caching</h2>
<p>The key principle: <mark><strong>Static content first, dynamic content last</strong></mark>.</p>
<p>‚ùå <strong>Cache-unfriendly structure</strong>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">## User Request</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{dynamic_user_input</span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Instructions</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="at">Static rules that could be cached but won</span><span class="st">'t be]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úÖ <strong>Cache-friendly structure</strong>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Identity</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">You are a senior code reviewer specializing in security analysis.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Instructions</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="at">1. Check for injection vulnerabilities</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="at">2. Validate input sanitization</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="at">... 500+ tokens of stable instructions ...</span><span class="kw">]</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Examples</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="at">... few-shot examples that rarely change ...</span><span class="kw">]</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">## User Request</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="at">{dynamic_content</span><span class="kw">}</span><span class="at">} &lt;!-- Only this part isn't cached --&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="token-savings-from-provider-caching" class="level3">
<h3 class="anchored" data-anchor-id="token-savings-from-provider-caching">Token savings from provider caching</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 34%">
<col style="width: 28%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Scenario</th>
<th>Without Caching</th>
<th>With Caching</th>
<th>Savings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>First request (1,500 token prefix)</td>
<td>1,500 tokens at full price</td>
<td>1,500 tokens at 1.25√ó (Anthropic)</td>
<td>-25% (write cost)</td>
</tr>
<tr class="even">
<td>Subsequent requests (same prefix)</td>
<td>1,500 tokens at full price</td>
<td>1,500 tokens at 0.1√ó (Anthropic)</td>
<td><mark><strong>90%</strong></mark></td>
</tr>
<tr class="odd">
<td>10 requests with same prefix</td>
<td>15,000 tokens</td>
<td>1,875 + 1,350 = 3,225 tokens</td>
<td><mark><strong>78%</strong></mark></td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
</section>
<section id="strategy-3-semantic-caching" class="level1">
<h1>üß† Strategy 3: Semantic caching</h1>
<p><mark><strong>Semantic caching</strong></mark> stores and retrieves results for <mark>semantically similar queries</mark>‚Äînot just exact matches. This is powerful for:</p>
<ul>
<li>Repeated questions with slight variations</li>
<li>Common patterns across projects</li>
<li>Expensive operations (web fetches, large analyses)</li>
</ul>
<section id="how-semantic-caching-works" class="level2">
<h2 class="anchored" data-anchor-id="how-semantic-caching-works">How semantic caching works</h2>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SEMANTIC CACHE ARCHITECTURE                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  User Query: "How do I authenticate users in Azure AD?"                 ‚îÇ
‚îÇ                           ‚îÇ                                             ‚îÇ
‚îÇ                           ‚ñº                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  1. EMBEDDING GENERATION                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     Convert query ‚Üí vector embedding [0.23, -0.15, 0.87, ...]   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                           ‚îÇ                                             ‚îÇ
‚îÇ                           ‚ñº                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  2. SIMILARITY SEARCH                                            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     Find cached queries with embedding distance &lt; threshold      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     ‚Ä¢ "Azure AD user authentication" (0.92 similarity) ‚úÖ        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     ‚Ä¢ "Set up OAuth in Azure" (0.78 similarity) ‚ö†Ô∏è               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     ‚Ä¢ "Install Azure CLI" (0.31 similarity) ‚ùå                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                           ‚îÇ                                             ‚îÇ
‚îÇ           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                            ‚îÇ
‚îÇ           ‚îÇ                               ‚îÇ                            ‚îÇ
‚îÇ           ‚ñº                               ‚ñº                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇ  CACHE HIT      ‚îÇ            ‚îÇ  CACHE MISS     ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  Return cached  ‚îÇ            ‚îÇ  Call LLM API   ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  response       ‚îÇ            ‚îÇ  Store result   ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  (0 tokens)     ‚îÇ            ‚îÇ  in cache       ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
</section>
<section id="implementation-gptcache" class="level2">
<h2 class="anchored" data-anchor-id="implementation-gptcache">Implementation: GPTCache</h2>
<p><a href="https://github.com/zilliztech/GPTCache">GPTCache</a> is an open-source semantic caching library:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gptcache <span class="im">import</span> cache</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gptcache.adapter <span class="im">import</span> openai</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize semantic cache</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>cache.init()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>cache.set_openai_key()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Queries with similar embeddings hit cache</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"How to authenticate Azure AD?"</span>}]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Second query with similar meaning ‚Üí cache hit</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>response2 <span class="op">=</span> openai.ChatCompletion.create(</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4"</span>, </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Azure AD authentication setup"</span>}]</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="when-semantic-caching-helps-vs.-hurts" class="level2">
<h2 class="anchored" data-anchor-id="when-semantic-caching-helps-vs.-hurts">When semantic caching helps vs.&nbsp;hurts</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>‚úÖ Good Use Cases</th>
<th>‚ùå Poor Use Cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Repeated documentation queries</td>
<td>Unique, context-specific questions</td>
</tr>
<tr class="even">
<td>Common coding patterns</td>
<td>Code with dynamic requirements</td>
</tr>
<tr class="odd">
<td>FAQ-style interactions</td>
<td>Creative/generative tasks</td>
</tr>
<tr class="even">
<td>Reference lookups</td>
<td>Tasks requiring current state</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="strategy-4-model-selection" class="level1">
<h1>üéöÔ∏è Strategy 4: Model selection</h1>
<p><mark><strong>Model selection</strong></mark> uses smaller, faster models for simpler tasks‚Äîmatching model capability to task complexity.</p>
<section id="the-model-selection-principle" class="level2">
<h2 class="anchored" data-anchor-id="the-model-selection-principle">The model selection principle</h2>
<p>From OpenAI‚Äôs latency optimization guide:</p>
<blockquote class="blockquote">
<p>‚ÄúSmaller models usually run faster (and cheaper), and when used correctly can even outperform larger models.‚Äù</p>
</blockquote>
</section>
<section id="when-to-use-which-model-size" class="level2">
<h2 class="anchored" data-anchor-id="when-to-use-which-model-size">When to use which model size</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 39%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Task Complexity</th>
<th>Recommended Model</th>
<th>Token Cost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Simple classification</strong></td>
<td>GPT-3.5, Claude Haiku</td>
<td><mark><strong>10-20√ó cheaper</strong></mark></td>
</tr>
<tr class="even">
<td><strong>Structured extraction</strong></td>
<td>GPT-4o-mini, Haiku</td>
<td><mark><strong>5-10√ó cheaper</strong></mark></td>
</tr>
<tr class="odd">
<td><strong>Code completion</strong></td>
<td>Fine-tuned smaller model</td>
<td>Variable</td>
</tr>
<tr class="even">
<td><strong>Complex reasoning</strong></td>
<td>GPT-4, Claude Sonnet/Opus</td>
<td>Full price</td>
</tr>
<tr class="odd">
<td><strong>Creative/nuanced writing</strong></td>
<td>GPT-4, Claude Opus</td>
<td>Full price</td>
</tr>
</tbody>
</table>
</section>
<section id="implementation-task-routing" class="level2">
<h2 class="anchored" data-anchor-id="implementation-task-routing">Implementation: Task routing</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># orchestrator.agent.md</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> task-router</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Route tasks to appropriate model size"</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Task Routing Rules</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">### Use SMALLER model (GPT-3.5 / Claude Haiku) for:</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Simple classification (sentiment, category)</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Structured data extraction</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Reformatting/transformation</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Simple Q&amp;A with clear answers</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">### Use LARGER model (GPT-4 / Claude Sonnet) for:</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Complex reasoning chains</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Nuanced analysis</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Creative content generation</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> Multi-step problem solving</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="practical-example-split-prompt-by-complexity" class="level2">
<h2 class="anchored" data-anchor-id="practical-example-split-prompt-by-complexity">Practical example: Split prompt by complexity</h2>
<p>From OpenAI‚Äôs latency guide‚Äîsplit a single GPT-4 prompt into two:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  BEFORE: Single GPT-4 request                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ GPT-4: Reasoning + Classification + Response Generation   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Cost: $$$                                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  AFTER: Split by complexity                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ GPT-3.5: Classification ‚îÇ ‚Üí ‚îÇ GPT-4: Response Generation  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ (cheap, fast)           ‚îÇ   ‚îÇ (only when needed)          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Cost: $                 ‚îÇ   ‚îÇ Cost: $$                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  TOTAL: $$ (vs $$$ before)                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
<section id="token-savings-from-model-selection" class="level3">
<h3 class="anchored" data-anchor-id="token-savings-from-model-selection">Token savings from model selection</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Approach</th>
<th>Cost per 1M tokens</th>
<th>Savings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>All GPT-4</td>
<td>~$30</td>
<td>‚Äî</td>
</tr>
<tr class="even">
<td>GPT-3.5 for 70% of tasks</td>
<td>~$10</td>
<td><mark><strong>67%</strong></mark></td>
</tr>
<tr class="odd">
<td>Fine-tuned GPT-3.5</td>
<td>~$8</td>
<td><mark><strong>73%</strong></mark></td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
</section>
<section id="strategy-5-batch-processing" class="level1">
<h1>üì¶ Strategy 5: Batch processing</h1>
<p><mark><strong>Batch processing</strong></mark> submits multiple requests together for asynchronous processing, receiving a <mark><strong>50% cost discount</strong></mark> from both OpenAI and Anthropic.</p>
<section id="when-to-use-batch-processing" class="level2">
<h2 class="anchored" data-anchor-id="when-to-use-batch-processing">When to use batch processing</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>‚úÖ Good Use Cases</th>
<th>‚ùå Poor Use Cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bulk content analysis</td>
<td>Real-time chat interactions</td>
</tr>
<tr class="even">
<td>Large-scale evaluations</td>
<td>Interactive coding assistance</td>
</tr>
<tr class="odd">
<td>Dataset classification</td>
<td>Time-sensitive operations</td>
</tr>
<tr class="even">
<td>Content moderation pipelines</td>
<td>User-facing latency-sensitive features</td>
</tr>
</tbody>
</table>
</section>
<section id="provider-batch-apis" class="level2">
<h2 class="anchored" data-anchor-id="provider-batch-apis">Provider batch APIs</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 30%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Provider</th>
<th>Discount</th>
<th>Max Batch Size</th>
<th>Completion Time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>OpenAI</strong></td>
<td><mark><strong>50%</strong></mark></td>
<td>50,000 requests or 200MB</td>
<td>Within 24 hours</td>
</tr>
<tr class="even">
<td><strong>Anthropic</strong></td>
<td><mark><strong>50%</strong></mark></td>
<td>100,000 requests or 256MB</td>
<td>Within 24 hours (usually &lt;1h)</td>
</tr>
</tbody>
</table>
</section>
<section id="implementation-example-anthropic" class="level2">
<h2 class="anchored" data-anchor-id="implementation-example-anthropic">Implementation example (Anthropic)</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> anthropic</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> anthropic.Anthropic()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create batch with multiple requests</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> client.messages.batches.create(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    requests<span class="op">=</span>[</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"custom_id"</span>: <span class="st">"article-1"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"params"</span>: {</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"model"</span>: <span class="st">"claude-sonnet-4-5"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"max_tokens"</span>: <span class="dv">1024</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"messages"</span>: [</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Analyze this article..."</span>}</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"custom_id"</span>: <span class="st">"article-2"</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"params"</span>: {</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"model"</span>: <span class="st">"claude-sonnet-4-5"</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"max_tokens"</span>: <span class="dv">1024</span>,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">"messages"</span>: [</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Analyze this article..."</span>}</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ... up to 100,000 requests</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Poll for completion</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> batch.processing_status <span class="op">!=</span> <span class="st">"ended"</span>:</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    batch <span class="op">=</span> client.messages.batches.retrieve(batch.<span class="bu">id</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">60</span>)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve results</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> client.messages.batches.results(batch.<span class="bu">id</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="combining-batch-processing-with-prompt-caching" class="level2">
<h2 class="anchored" data-anchor-id="combining-batch-processing-with-prompt-caching">Combining batch processing with prompt caching</h2>
<p>Batch processing and prompt caching discounts <mark><strong>stack</strong></mark>:</p>
<blockquote class="blockquote">
<p><strong>‚ö†Ô∏è Important:</strong> Cache hits in batch processing are <strong>best-effort</strong> due to asynchronous, concurrent processing. Anthropic reports typical cache hit rates of 30-98% depending on traffic patterns. To maximize hits: include identical <code>cache_control</code> blocks in every request, maintain steady request flow, and consider the 1-hour cache TTL for batch workloads.</p>
</blockquote>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Optimization</th>
<th>Discount</th>
<th>Combined</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Batch only</td>
<td>50%</td>
<td>50%</td>
</tr>
<tr class="even">
<td>Cache read only</td>
<td>90%</td>
<td>90%</td>
</tr>
<tr class="odd">
<td><strong>Batch + Cache read</strong></td>
<td>50% + 90%</td>
<td><mark><strong>95%</strong></mark></td>
</tr>
</tbody>
</table>
<section id="token-savings-from-batch-processing" class="level3">
<h3 class="anchored" data-anchor-id="token-savings-from-batch-processing">Token savings from batch processing</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Scenario</th>
<th>Standard API</th>
<th>Batch API</th>
<th>Savings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1,000 article validations</td>
<td>$30</td>
<td>$15</td>
<td><mark><strong>50%</strong></mark></td>
</tr>
<tr class="even">
<td>With prompt caching</td>
<td>$15</td>
<td>$7.50</td>
<td><mark><strong>75%</strong></mark> (combined)</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
</section>
<section id="strategy-6-request-consolidation" class="level1">
<h1>üîó Strategy 6: Request consolidation</h1>
<p><mark><strong>Request consolidation</strong></mark> combines multiple sequential LLM calls into a single request, eliminating round-trip latency and reducing total tokens.</p>
<section id="the-consolidation-principle" class="level2">
<h2 class="anchored" data-anchor-id="the-consolidation-principle">The consolidation principle</h2>
<p>From OpenAI‚Äôs latency guide:</p>
<blockquote class="blockquote">
<p>‚ÄúEach time you make a request you incur some round-trip latency. If you have sequential steps for the LLM to perform, instead of firing off one request per step consider putting them in a single prompt.‚Äù</p>
</blockquote>
</section>
<section id="before-vs.-after-consolidation" class="level2">
<h2 class="anchored" data-anchor-id="before-vs.-after-consolidation">Before vs.&nbsp;After consolidation</h2>
<p>‚ùå <strong>Before: Sequential requests</strong></p>
<pre><code>Request 1: "Classify this text"           ‚Üí 200 tokens
Request 2: "Extract entities"             ‚Üí 300 tokens  
Request 3: "Summarize findings"           ‚Üí 400 tokens
                                          ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
TOTAL: 3 requests, ~900 tokens + 3√ó round-trip latency</code></pre>
<p>‚úÖ <strong>After: Consolidated request</strong></p>
<pre><code>Single Request: 
"Perform the following in sequence:
1. Classify this text
2. Extract entities
3. Summarize findings

Return results as JSON with keys: classification, entities, summary"

TOTAL: 1 request, ~600 tokens + 1√ó round-trip latency</code></pre>
</section>
<section id="implementation-pattern" class="level2">
<h2 class="anchored" data-anchor-id="implementation-pattern">Implementation pattern</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> consolidated-analysis</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Multiple analysis steps in one request"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Task</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Perform ALL of the following analyses on the provided content</span><span class="kw">:</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">1. **Classification**</span><span class="kw">:</span><span class="at"> Categorize the content type</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">2. **Entity Extraction**</span><span class="kw">:</span><span class="at"> Identify key entities (people, places, concepts)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">3. **Sentiment Analysis**</span><span class="kw">:</span><span class="at"> Determine overall sentiment</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">4. **Summary**</span><span class="kw">:</span><span class="at"> Create a 2-sentence summary</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">## Output Format</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="fu">Return a single JSON object</span><span class="kw">:</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="at">```json</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"classification"</span><span class="kw">:</span><span class="at"> </span><span class="st">"..."</span><span class="kw">,</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"entities"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">...</span><span class="kw">],</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"sentiment"</span><span class="kw">:</span><span class="at"> </span><span class="st">"positive|neutral|negative"</span><span class="kw">,</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"summary"</span><span class="kw">:</span><span class="at"> </span><span class="st">"..."</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>
### Token savings from consolidation

| Approach | Requests | Tokens | Savings |
|----------|----------|--------|---------|
| Sequential (3 requests) | 3 | ~900 | ‚Äî |
| Consolidated (1 request) | 1 | ~600 | &lt;mark&gt;**33% tokens + 66% latency**&lt;/mark&gt; |

---

# üìâ Strategy 7: Output token reduction

&lt;mark&gt;**Output token reduction**&lt;/mark&gt; generates fewer response tokens‚Äîoften the highest-latency step in LLM processing.

## The output token principle

From OpenAI's latency guide:

&gt; "Generating tokens is almost always the highest latency step when using an LLM: cutting 50% of your output tokens may cut ~50% your latency."

## Techniques for reducing output tokens

### Technique 7.1: Explicit brevity instructions

```markdown
## Response Guidelines

- Keep responses under 100 words
- Use bullet points, not paragraphs
- Omit pleasantries and preamble
- Answer directly, then stop</code></pre>
<section id="technique-7.2-shortened-json-field-names" class="level3">
<h3 class="anchored" data-anchor-id="technique-7.2-shortened-json-field-names">Technique 7.2: Shortened JSON field names</h3>
<p>‚ùå <strong>Verbose output</strong> (~120 tokens):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"message_is_conversation_continuation"</span><span class="fu">:</span> <span class="st">"True"</span><span class="fu">,</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"number_of_messages_in_conversation_so_far"</span><span class="fu">:</span> <span class="st">"5"</span><span class="fu">,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"user_sentiment"</span><span class="fu">:</span> <span class="st">"Frustrated"</span><span class="fu">,</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"query_type"</span><span class="fu">:</span> <span class="st">"Technical Support"</span><span class="fu">,</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"response_requirements"</span><span class="fu">:</span> <span class="st">"Provide step-by-step troubleshooting"</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úÖ <strong>Compact output</strong> (~50 tokens):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"cont"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"n_msg"</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"tone"</span><span class="fu">:</span> <span class="st">"frustrated"</span><span class="fu">,</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"tech_support"</span><span class="fu">,</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"reqs"</span><span class="fu">:</span> <span class="st">"troubleshoot_steps"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="technique-7.3-use-max_tokens-and-stop_tokens" class="level3">
<h3 class="anchored" data-anchor-id="technique-7.3-use-max_tokens-and-stop_tokens">Technique 7.3: Use <code>max_tokens</code> and <code>stop_tokens</code></h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[...],</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span><span class="dv">500</span>,  <span class="co"># Hard limit on output</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    stop<span class="op">=</span>[<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>, <span class="st">"---"</span>]  <span class="co"># Stop at section breaks</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="token-savings-from-output-reduction" class="level3">
<h3 class="anchored" data-anchor-id="token-savings-from-output-reduction">Token savings from output reduction</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Technique</th>
<th>Before</th>
<th>After</th>
<th>Savings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Brevity instructions</td>
<td>~500 tokens</td>
<td>~150 tokens</td>
<td><mark><strong>70%</strong></mark></td>
</tr>
<tr class="even">
<td>Shortened field names</td>
<td>~120 tokens</td>
<td>~50 tokens</td>
<td><mark><strong>58%</strong></mark></td>
</tr>
<tr class="odd">
<td>max_tokens limit</td>
<td>Variable</td>
<td>Capped</td>
<td>Predictable</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
</section>
<section id="strategy-8-deterministic-tools" class="level1">
<h1>‚öôÔ∏è Strategy 8: Deterministic tools</h1>
<p><mark><strong>Deterministic tools</strong></mark> bypass AI entirely for operations that don‚Äôt require intelligence‚Äîthey‚Äôre <mark><strong>infinitely faster and consume zero tokens</strong></mark>.</p>
<section id="when-to-use-deterministic-tools" class="level2">
<h2 class="anchored" data-anchor-id="when-to-use-deterministic-tools">When to use deterministic tools</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation Type</th>
<th>Use AI?</th>
<th>Use Deterministic Tool?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Parse YAML frontmatter</td>
<td>‚ùå</td>
<td>‚úÖ Regex/parser</td>
</tr>
<tr class="even">
<td>Check if file exists</td>
<td>‚ùå</td>
<td>‚úÖ File system check</td>
</tr>
<tr class="odd">
<td>Validate JSON schema</td>
<td>‚ùå</td>
<td>‚úÖ JSON Schema validator</td>
</tr>
<tr class="even">
<td>Count lines matching pattern</td>
<td>‚ùå</td>
<td>‚úÖ grep + wc</td>
</tr>
<tr class="odd">
<td>Calculate hash/checksum</td>
<td>‚ùå</td>
<td>‚úÖ Hash function</td>
</tr>
<tr class="even">
<td>Compare timestamps</td>
<td>‚ùå</td>
<td>‚úÖ Date comparison</td>
</tr>
<tr class="odd">
<td><strong>Analyze code semantics</strong></td>
<td>‚úÖ</td>
<td>‚ùå</td>
</tr>
<tr class="even">
<td><strong>Generate creative content</strong></td>
<td>‚úÖ</td>
<td>‚ùå</td>
</tr>
<tr class="odd">
<td><strong>Make judgment calls</strong></td>
<td>‚úÖ</td>
<td>‚ùå</td>
</tr>
</tbody>
</table>
</section>
<section id="implementation-mcp-server-with-deterministic-tools" class="level2">
<h2 class="anchored" data-anchor-id="implementation-mcp-server-with-deterministic-tools">Implementation: MCP server with deterministic tools</h2>
<p>The key insight: <mark>wrap deterministic operations in MCP tools</mark> so agents can invoke them without AI processing.</p>
<p><strong>Example: Validation cache check (deterministic)</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// IQPilot MCP Server - CheckValidationCache tool</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">McpTool</span><span class="op">(</span><span class="st">"check_validation_cache"</span><span class="op">)]</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>CacheCheckResult<span class="op">&gt;</span> <span class="fu">CheckValidationCache</span><span class="op">(</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> filePath<span class="op">,</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> validationType<span class="op">,</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cacheDays <span class="op">=</span> <span class="dv">7</span><span class="op">)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pure file parsing - no AI involved</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> metadata <span class="op">=</span> await <span class="fu">ParseBottomMetadata</span><span class="op">(</span>filePath<span class="op">);</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>metadata<span class="op">.</span><span class="fu">Validations</span><span class="op">.</span><span class="fu">TryGetValue</span><span class="op">(</span>validationType<span class="op">,</span> <span class="kw">out</span> <span class="dt">var</span> validation<span class="op">))</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> lastRun <span class="op">=</span> validation<span class="op">.</span><span class="fu">LastRun</span><span class="op">;</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> daysSinceRun <span class="op">=</span> <span class="op">(</span>DateTime<span class="op">.</span><span class="fu">UtcNow</span> <span class="op">-</span> lastRun<span class="op">).</span><span class="fu">TotalDays</span><span class="op">;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>daysSinceRun <span class="op">&lt;</span> cacheDays<span class="op">)</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">new</span> CacheCheckResult</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                IsCached <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>                CachedResult <span class="op">=</span> validation<span class="op">.</span><span class="fu">Outcome</span><span class="op">,</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>                DaysSinceRun <span class="op">=</span> daysSinceRun<span class="op">,</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>                Message <span class="op">=</span> $<span class="st">"Cache valid. Last run: {lastRun:yyyy-MM-dd}"</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">new</span> CacheCheckResult</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        IsCached <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>        Message <span class="op">=</span> <span class="st">"No valid cache found. Run validation."</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Agent prompt using deterministic tool</strong>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> grammar-review-cached</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tools</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'check_validation_cache'</span><span class="kw">,</span><span class="at"> </span><span class="st">'read_file'</span><span class="kw">,</span><span class="at"> </span><span class="st">'replace_string_in_file'</span><span class="kw">]</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Process</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">### Phase 1: Cache Check (DETERMINISTIC - Zero tokens)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">1. Call `check_validation_cache`</span><span class="kw">:</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">filePath</span><span class="kw">:</span><span class="at"> target file</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">validationType</span><span class="kw">:</span><span class="at"> </span><span class="st">"grammar"</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">cacheDays</span><span class="kw">:</span><span class="at"> </span><span class="dv">7</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="at">2. **IF cache is valid** ‚Üí Report cached result ‚Üí EXIT</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="at">3. **IF no cache** ‚Üí Proceed to Phase 2</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">### Phase 2: Grammar Validation (AI - Consumes tokens)</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="at">Only reached if cache miss. Perform full validation...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="token-savings-from-deterministic-cache-checks" class="level3">
<h3 class="anchored" data-anchor-id="token-savings-from-deterministic-cache-checks">Token savings from deterministic cache checks</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Scenario</th>
<th>Without Deterministic Check</th>
<th>With Deterministic Check</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cache hit (70% of cases)</td>
<td>3,000 tokens</td>
<td>0 tokens</td>
</tr>
<tr class="even">
<td>Cache miss (30% of cases)</td>
<td>3,000 tokens</td>
<td>3,000 tokens</td>
</tr>
<tr class="odd">
<td><strong>Expected tokens per run</strong></td>
<td>3,000 tokens</td>
<td>900 tokens</td>
</tr>
<tr class="even">
<td><strong>Savings</strong></td>
<td></td>
<td><mark><strong>70%</strong></mark></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="common-deterministic-operations-to-implement" class="level2">
<h2 class="anchored" data-anchor-id="common-deterministic-operations-to-implement">Common deterministic operations to implement</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 36%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th>Implementation</th>
<th>Token Savings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Metadata parsing</strong></td>
<td>YAML parser, regex</td>
<td>Avoid AI parsing docs</td>
</tr>
<tr class="even">
<td><strong>File existence check</strong></td>
<td><code>File.Exists()</code></td>
<td>Avoid AI file searches</td>
</tr>
<tr class="odd">
<td><strong>Link validation</strong></td>
<td>HTTP HEAD request</td>
<td>Avoid AI fetching pages</td>
</tr>
<tr class="even">
<td><strong>Pattern matching</strong></td>
<td>Regex engine</td>
<td>Avoid AI text analysis</td>
</tr>
<tr class="odd">
<td><strong>Schema validation</strong></td>
<td>JSON Schema validator</td>
<td>Avoid AI structure checks</td>
</tr>
<tr class="even">
<td><strong>Diff computation</strong></td>
<td>Git diff</td>
<td>Avoid AI comparison</td>
</tr>
<tr class="odd">
<td><strong>Timestamp comparison</strong></td>
<td>Date arithmetic</td>
<td>Avoid AI date reasoning</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="strategy-9-streaming-and-parallelization" class="level1">
<h1>‚ö° Strategy 9: Streaming and parallelization</h1>
<p><mark><strong>Streaming and parallelization</strong></mark> don‚Äôt reduce actual token costs but dramatically improve <mark>perceived latency and throughput</mark>. These techniques are essential for production-quality user experiences.</p>
<section id="streaming-progressive-output-delivery" class="level2">
<h2 class="anchored" data-anchor-id="streaming-progressive-output-delivery">Streaming: Progressive output delivery</h2>
<p>Streaming delivers tokens as they‚Äôre generated instead of waiting for the complete response:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    STREAMING vs BATCH RESPONSE                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  WITHOUT STREAMING:                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Request ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Response  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ          [User waits 3-5 seconds seeing nothing...]              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  WITH STREAMING:                                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Request ‚îÄ‚îÄ‚ñ∂ Here ‚îÄ‚îÄ‚ñ∂ is ‚îÄ‚îÄ‚ñ∂ the ‚îÄ‚îÄ‚ñ∂ response ‚îÄ‚îÄ‚ñ∂ ...             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         [~100ms] [~100ms] [~100ms] [~100ms]                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         [User sees progress immediately]                          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  PERCEIVED LATENCY: 100ms vs 3-5 seconds                               ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
<section id="when-to-use-streaming" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-streaming">When to use streaming</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>‚úÖ Good Use Cases</th>
<th>‚ùå Poor Use Cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>User-facing chat interfaces</td>
<td>Background batch processing</td>
</tr>
<tr class="even">
<td>Code generation with preview</td>
<td>API integrations requiring complete response</td>
</tr>
<tr class="odd">
<td>Documentation generation</td>
<td>Validation pipelines</td>
</tr>
<tr class="even">
<td>Interactive debugging</td>
<td>Structured JSON output parsing</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="parallelization-concurrent-independent-tasks" class="level2">
<h2 class="anchored" data-anchor-id="parallelization-concurrent-independent-tasks">Parallelization: Concurrent independent tasks</h2>
<p>When tasks don‚Äôt depend on each other, process them <mark><strong>concurrently</strong></mark> rather than sequentially:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SEQUENTIAL vs PARALLEL EXECUTION                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  SEQUENTIAL (Bad):                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ  ‚îÇ Task 1  ‚îÇ‚îÄ‚îÄ‚ñ∂‚îÇ Task 2  ‚îÇ‚îÄ‚îÄ‚ñ∂‚îÇ Task 3  ‚îÇ‚îÄ‚îÄ‚ñ∂‚îÇ Task 4  ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ  2 sec  ‚îÇ   ‚îÇ  2 sec  ‚îÇ   ‚îÇ  2 sec  ‚îÇ   ‚îÇ  2 sec  ‚îÇ                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ  Total time: 8 seconds                                                  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  PARALLEL (Good - when tasks are independent):                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                            ‚îÇ
‚îÇ  ‚îÇ Task 1  ‚îÇ                                                            ‚îÇ
‚îÇ  ‚îÇ  2 sec  ‚îÇ                                                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                                                            ‚îÇ
‚îÇ  ‚îÇ Task 2  ‚îÇ     All complete at ~2 seconds                            ‚îÇ
‚îÇ  ‚îÇ  2 sec  ‚îÇ                                                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                                                            ‚îÇ
‚îÇ  ‚îÇ Task 3  ‚îÇ                                                            ‚îÇ
‚îÇ  ‚îÇ  2 sec  ‚îÇ                                                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                                                            ‚îÇ
‚îÇ  ‚îÇ Task 4  ‚îÇ                                                            ‚îÇ
‚îÇ  ‚îÇ  2 sec  ‚îÇ                                                            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                            ‚îÇ
‚îÇ  Total time: ~2 seconds (4√ó faster)                                    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
<section id="implementation-parallel-validation" class="level3">
<h3 class="anchored" data-anchor-id="implementation-parallel-validation">Implementation: Parallel validation</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Validate multiple articles in parallel</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>ValidationReport<span class="op">[]&gt;</span> <span class="fu">ValidateArticles</span><span class="op">(</span><span class="dt">string</span><span class="op">[]</span> articlePaths<span class="op">)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> validationTasks <span class="op">=</span> articlePaths<span class="op">.</span><span class="fu">Select</span><span class="op">(</span>async path <span class="op">=&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> content <span class="op">=</span> await File<span class="op">.</span><span class="fu">ReadAllTextAsync</span><span class="op">(</span>path<span class="op">);</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// These validations can run in parallel</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> grammarTask <span class="op">=</span> <span class="fu">ValidateGrammarAsync</span><span class="op">(</span>content<span class="op">);</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> readabilityTask <span class="op">=</span> <span class="fu">ValidateReadabilityAsync</span><span class="op">(</span>content<span class="op">);</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> structureTask <span class="op">=</span> <span class="fu">ValidateStructureAsync</span><span class="op">(</span>content<span class="op">);</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> linksTask <span class="op">=</span> <span class="fu">ValidateLinksAsync</span><span class="op">(</span>content<span class="op">);</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        await Task<span class="op">.</span><span class="fu">WhenAll</span><span class="op">(</span>grammarTask<span class="op">,</span> readabilityTask<span class="op">,</span> structureTask<span class="op">,</span> linksTask<span class="op">);</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">new</span> ValidationReport</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>            Path <span class="op">=</span> path<span class="op">,</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>            Grammar <span class="op">=</span> await grammarTask<span class="op">,</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>            Readability <span class="op">=</span> await readabilityTask<span class="op">,</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>            Structure <span class="op">=</span> await structureTask<span class="op">,</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>            Links <span class="op">=</span> await linksTask</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> await Task<span class="op">.</span><span class="fu">WhenAll</span><span class="op">(</span>validationTasks<span class="op">);</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="speculative-execution-predicted-outputs" class="level2">
<h2 class="anchored" data-anchor-id="speculative-execution-predicted-outputs">Speculative execution: Predicted outputs</h2>
<p>OpenAI‚Äôs <mark><strong>Predicted Outputs</strong></mark> feature reduces latency when you know most of the expected output:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># When editing code, most of the file stays the same</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>code <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="st">def calculate_total(items):</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="st">    total = 0</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="st">    for item in items:</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="st">        total += item.price</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="st">    return total</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"gpt-4o"</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[{</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: <span class="ss">f"Add tax calculation to this function:</span><span class="ch">\n</span><span class="sc">{</span>code<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    }],</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    prediction<span class="op">=</span>{</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span>: <span class="st">"content"</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: code  <span class="co"># Most of this content will be in output</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Latency reduced by ~2-3√ó because unchanged tokens </span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co"># are confirmed rather than regenerated</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="when-speculative-execution-helps" class="level3">
<h3 class="anchored" data-anchor-id="when-speculative-execution-helps">When speculative execution helps</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Scenario</th>
<th>Latency Reduction</th>
<th>Best Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Code refactoring (small changes)</td>
<td>2-3√ó</td>
<td>gpt-4o, gpt-4o-mini</td>
</tr>
<tr class="even">
<td>Document editing</td>
<td>2√ó</td>
<td>gpt-4o</td>
</tr>
<tr class="odd">
<td>Template completion</td>
<td>3-4√ó</td>
<td>gpt-4o-mini</td>
</tr>
<tr class="even">
<td>Translation with preserved formatting</td>
<td>2√ó</td>
<td>gpt-4o</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="combined-latency-optimization" class="level2">
<h2 class="anchored" data-anchor-id="combined-latency-optimization">Combined latency optimization</h2>
<p>A well-optimized user-facing workflow combines these techniques:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    OPTIMAL LATENCY ARCHITECTURE                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  User Request                                                           ‚îÇ
‚îÇ       ‚îÇ                                                                 ‚îÇ
‚îÇ       ‚ñº                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ PARALLEL SETUP (concurrent)                                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Check cache  ‚îÇ ‚îÇ Fetch context‚îÇ ‚îÇ Load templates‚îÇ              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ       ‚îÇ                                                                 ‚îÇ
‚îÇ       ‚ñº                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ STREAMING RESPONSE                                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ User sees tokens appear immediately (~100ms first token)         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ If editing existing content: use PREDICTED OUTPUTS               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ for 2-3√ó additional latency reduction                            ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ       ‚îÇ                                                                 ‚îÇ
‚îÇ       ‚ñº                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ PARALLEL POST-PROCESSING (while user sees response)             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Update cache ‚îÇ ‚îÇ Log metrics  ‚îÇ ‚îÇ Pre-warm next‚îÇ              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  RESULT: Sub-second perceived latency                                  ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
<hr>
</section>
</section>
<section id="strategy-comparison-matrix" class="level1">
<h1>üìà Strategy comparison matrix</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 31%">
<col style="width: 14%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Strategy</th>
<th>Token Savings</th>
<th>Implementation Effort</th>
<th>Best For</th>
<th>Limitations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><mark>1. Context Reduction</mark></strong></td>
<td>30-90%</td>
<td>Low</td>
<td>All workflows</td>
<td>Requires discipline</td>
</tr>
<tr class="even">
<td><strong><mark>2. Provider Caching</mark></strong></td>
<td>50-90% (stable prefixes)</td>
<td>Low (structure prompts correctly)</td>
<td>High-volume, consistent prompts</td>
<td>Minimum token requirements</td>
</tr>
<tr class="odd">
<td><strong><mark>3. Semantic Caching</mark></strong></td>
<td>50-80% (high hit scenarios)</td>
<td>High (embedding infrastructure)</td>
<td>Repeated queries, documentation</td>
<td>Stale data risk, false positives</td>
</tr>
<tr class="even">
<td><strong><mark>4. Model Selection</mark></strong></td>
<td>60-80%</td>
<td>Low</td>
<td>Simple tasks, high volume</td>
<td>May reduce quality for complex tasks</td>
</tr>
<tr class="odd">
<td><strong><mark>5. Batch Processing</mark></strong></td>
<td>50% cost</td>
<td>Low</td>
<td>Non-urgent, high volume</td>
<td>24h latency</td>
</tr>
<tr class="even">
<td><strong><mark>6. Request Consolidation</mark></strong></td>
<td>40-60%</td>
<td>Medium</td>
<td>Multi-step pipelines</td>
<td>Increased prompt complexity</td>
</tr>
<tr class="odd">
<td><strong><mark>7. Output Reduction</mark></strong></td>
<td>30-50%</td>
<td>Low</td>
<td>Verbose outputs</td>
<td>May lose useful detail</td>
</tr>
<tr class="even">
<td><strong><mark>8. Deterministic Tools</mark></strong></td>
<td>70-100%</td>
<td>Medium (MCP development)</td>
<td>Cache checks, validation, file ops</td>
<td>Limited to predictable operations</td>
</tr>
<tr class="odd">
<td><strong><mark>9. Streaming/Parallelization</mark></strong></td>
<td>Latency only</td>
<td>Low-Medium</td>
<td>User-facing, independent tasks</td>
<td>No token savings</td>
</tr>
</tbody>
</table>
<section id="strategy-selection-flowchart" class="level2">
<h2 class="anchored" data-anchor-id="strategy-selection-flowchart">Strategy selection flowchart</h2>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    OPTIMIZATION STRATEGY SELECTION                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Is the operation predictable/deterministic?
‚îú‚îÄ‚îÄ YES ‚Üí Use DETERMINISTIC TOOL (zero tokens)
‚îÇ         Examples: cache checks, file existence, schema validation
‚îÇ
‚îî‚îÄ‚îÄ NO ‚Üí Is it a repeated query pattern?
         ‚îú‚îÄ‚îÄ YES ‚Üí Is the prefix stable?
         ‚îÇ         ‚îú‚îÄ‚îÄ YES ‚Üí Use PROVIDER CACHING (90% savings)
         ‚îÇ         ‚îÇ         Structure: static first, dynamic last
         ‚îÇ         ‚îÇ
         ‚îÇ         ‚îî‚îÄ‚îÄ NO ‚Üí Consider SEMANTIC CACHING (50-80% savings)
         ‚îÇ                  If query variations are semantically similar
         ‚îÇ
         ‚îî‚îÄ‚îÄ NO ‚Üí Is it high volume, non-urgent?
                  ‚îú‚îÄ‚îÄ YES ‚Üí Use BATCH PROCESSING (50% discount)
                  ‚îÇ
                  ‚îî‚îÄ‚îÄ NO ‚Üí Is output verbose?
                           ‚îú‚îÄ‚îÄ YES ‚Üí Use OUTPUT REDUCTION (30-50% savings)
                           ‚îÇ
                           ‚îî‚îÄ‚îÄ NO ‚Üí Use CONTEXT REDUCTION (30-90% savings)
                                    ‚Ä¢ Targeted file reads
                                    ‚Ä¢ Search result limits
                                    ‚Ä¢ Progressive summarization</code></pre>
</section>
<section id="combined-optimization-example" class="level2">
<h2 class="anchored" data-anchor-id="combined-optimization-example">Combined optimization example</h2>
<p>A well-optimized 5-phase workflow uses <mark><strong>multiple strategies in combination</strong></mark>:</p>
<pre><code>Phase 1: Research
‚îú‚îÄ‚îÄ MODEL SELECTION: Use GPT-4o-mini for initial search
‚îú‚îÄ‚îÄ CONTEXT REDUCTION: Limit search to 5 results
‚îú‚îÄ‚îÄ PROVIDER CACHING: Stable research prompt prefix
‚îî‚îÄ‚îÄ Expected: 70% savings

Phase 2: Cache Check
‚îú‚îÄ‚îÄ DETERMINISTIC TOOL: Check existing validation cache
‚îú‚îÄ‚îÄ If cache hit: Skip remaining phases
‚îî‚îÄ‚îÄ Expected: 70% of runs skip AI entirely

Phase 3: Analysis (cache miss only)
‚îú‚îÄ‚îÄ CONTEXT REDUCTION: Read only relevant sections
‚îú‚îÄ‚îÄ PROVIDER CACHING: Stable analysis prompt
‚îú‚îÄ‚îÄ REQUEST CONSOLIDATION: Combine grammar + readability checks
‚îî‚îÄ‚îÄ Expected: 60% savings

Phase 4: Generation
‚îú‚îÄ‚îÄ CONTEXT REDUCTION: Progressive summary from Phase 3
‚îú‚îÄ‚îÄ SEMANTIC CACHING: Cache common generation patterns
‚îú‚îÄ‚îÄ OUTPUT REDUCTION: Structured JSON output only
‚îî‚îÄ‚îÄ Expected: 50% savings

Phase 5: Validation
‚îú‚îÄ‚îÄ DETERMINISTIC TOOL: Schema validation, link checks
‚îú‚îÄ‚îÄ BATCH PROCESSING: Queue non-urgent validations
‚îú‚îÄ‚îÄ Only AI for: Grammar, readability, semantic checks
‚îî‚îÄ‚îÄ Expected: 70% of checks bypass AI

CUMULATIVE SAVINGS: 75-90%</code></pre>
<hr>
</section>
</section>
<section id="implementation-patterns" class="level1">
<h1>üîß Implementation patterns</h1>
<section id="pattern-1-validation-pipeline-with-caching" class="level2">
<h2 class="anchored" data-anchor-id="pattern-1-validation-pipeline-with-caching">Pattern 1: Validation pipeline with caching</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># validation-pipeline.prompt.md</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> validation-pipeline</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Multi-validation with deterministic cache checks"</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tools</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">'check_validation_cache'</span><span class="kw">,</span><span class="at"> </span><span class="st">'run_grammar_check'</span><span class="kw">,</span><span class="at"> </span><span class="st">'run_readability_check'</span><span class="kw">]</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Process</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">### Step 1: Batch Cache Check (DETERMINISTIC)</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="fu">For each validation type (grammar, readability, structure, fact-check)</span><span class="kw">:</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="at">1. Call `check_validation_cache(file, type, days=7)`</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="at">2. Record which validations need running</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">### Step 2: Run Only Missing Validations (AI)</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="fu">For each validation NOT in cache</span><span class="kw">:</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="at">1. Run appropriate validation prompt</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="at">2. Store result in metadata cache</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">### Step 3: Aggregate Results</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="at">Combine cached + fresh results into unified report.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pattern-2-research-with-semantic-caching" class="level2">
<h2 class="anchored" data-anchor-id="pattern-2-research-with-semantic-caching">Pattern 2: Research with semantic caching</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Research pattern with semantic cache</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> research_topic(topic: <span class="bu">str</span>, cache: SemanticCache):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check semantic cache first</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    cached <span class="op">=</span> <span class="cf">await</span> cache.get_similar(topic)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cached <span class="kw">and</span> cached.similarity <span class="op">&gt;</span> <span class="fl">0.90</span>:</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cached.response</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cache miss - perform research</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> <span class="cf">await</span> perform_research(topic)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store for future similar queries</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> cache.store(topic, results)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pattern-3-progressive-summarization-handoff" class="level2">
<h2 class="anchored" data-anchor-id="pattern-3-progressive-summarization-handoff">Pattern 3: Progressive summarization handoff</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># builder.agent.md</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> builder</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">handoffs</span><span class="kw">:</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">label</span><span class="kw">:</span><span class="at"> </span><span class="st">"Validate Result"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">agent</span><span class="kw">:</span><span class="at"> validator</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">send</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">    # Don't send full context</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">    prompt</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      **Summary from Builder:**</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      {{PHASE_SUMMARY}}</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>      **Artifact location:** {{OUTPUT_FILE}}</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>      Validate the created artifact.</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">## Phase Completion Instructions</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="fu">Before any handoff, produce a PHASE_SUMMARY (max 200 tokens)</span><span class="kw">:</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="at">1. Decisions made (bullet list)</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="at">2. Artifacts created (file paths)</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="at">3. Key constraints applied</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="at">4. Specific validation needs</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="at">Store full details in output file for reference if needed.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="common-pitfalls" class="level1">
<h1>‚ö†Ô∏è Common pitfalls</h1>
<section id="pitfall-1-over-caching-dynamic-content" class="level2">
<h2 class="anchored" data-anchor-id="pitfall-1-over-caching-dynamic-content">Pitfall 1: Over-caching dynamic content</h2>
<p>‚ùå <strong>Wrong</strong>: Caching responses that depend on current file state</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DON'T cache file-dependent analyses</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cache.store(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"analyze security of auth.py"</span>,  <span class="co"># Query seems cacheable...</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    analysis_result  <span class="co"># But result depends on file content!</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úÖ <strong>Right</strong>: Include content hash in cache key</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>content_hash <span class="op">=</span> hashlib.md5(file_content.encode()).hexdigest()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>cache.store(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"analyze security of auth.py:</span><span class="sc">{</span>content_hash<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    analysis_result</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pitfall-2-cache-key-collisions" class="level2">
<h2 class="anchored" data-anchor-id="pitfall-2-cache-key-collisions">Pitfall 2: Cache key collisions</h2>
<p>‚ùå <strong>Wrong</strong>: Overly broad cache keys</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cache.store(<span class="st">"validate article"</span>, result)  <span class="co"># Which article?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úÖ <strong>Right</strong>: Include all relevant context in key</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>cache.store(<span class="ss">f"validate:</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>validation_type<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>content_hash<span class="sc">}</span><span class="ss">"</span>, result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pitfall-3-ignoring-cache-write-costs" class="level2">
<h2 class="anchored" data-anchor-id="pitfall-3-ignoring-cache-write-costs">Pitfall 3: Ignoring cache write costs</h2>
<p>For Anthropic, cache writes cost <mark><strong>25% more</strong></mark> than regular input tokens.</p>
<p>‚ùå <strong>Wrong</strong>: Caching tiny prefixes that are rarely reused</p>
<p>‚úÖ <strong>Right</strong>: Only cache prefixes that will be reused 3+ times</p>
<pre><code>Break-even calculation (Anthropic):
- Cache write: 1.25√ó base cost
- Cache read: 0.1√ó base cost

To save money: Need 2+ cache hits to offset write cost
  1.25 (write) + 0.1 (read) + 0.1 (read) = 1.45
  vs. 1.0 + 1.0 + 1.0 = 3.0 without caching

Savings start at 3rd use.</code></pre>
</section>
<section id="pitfall-4-placing-dynamic-content-before-static" class="level2">
<h2 class="anchored" data-anchor-id="pitfall-4-placing-dynamic-content-before-static">Pitfall 4: Placing dynamic content before static</h2>
<p>‚ùå <strong>Wrong</strong>: User input first</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## User Request: {{input}}</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Instructions (static)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">These won't be cached because they come after dynamic content</span><span class="co">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>‚úÖ <strong>Right</strong>: Static first, dynamic last</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">## Instructions (static - cached)</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">1,000+ tokens of stable content</span><span class="co">]</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">## User Request: {{input}}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="conclusion" class="level1">
<h1>üéØ Conclusion</h1>
<p>Token optimization isn‚Äôt optional for production AI workflows‚Äîit‚Äôs the difference between sustainable and unsustainable costs.</p>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key takeaways</h2>
<ol type="1">
<li><strong><mark>Context reduction</mark></strong> is the foundation: targeted reads, limited searches, progressive summarization</li>
<li><strong><mark>Provider caching</mark></strong> offers up to 90% savings‚Äîstructure prompts with static content first</li>
<li><strong><mark>Semantic caching</mark></strong> captures similar queries‚Äîpowerful for documentation and reference lookups</li>
<li><strong><mark>Model selection</mark></strong> and <strong>batch processing</strong> provide substantial cost reduction for high-volume workflows</li>
<li><strong><mark>Request consolidation</mark></strong> and <strong>output reduction</strong> minimize token counts per interaction</li>
<li><strong><mark>Deterministic tools</mark></strong> bypass AI entirely for predictable operations‚Äîcache checks, validation, file operations</li>
<li><strong><mark>Streaming/parallelization</mark></strong> improve perceived latency without changing token costs</li>
</ol>
</section>
<section id="implementation-priority" class="level2">
<h2 class="anchored" data-anchor-id="implementation-priority">Implementation priority</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 37%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>Priority</th>
<th>Strategy</th>
<th>Expected Savings</th>
<th>Effort</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Context reduction (targeted reads)</td>
<td>30-50%</td>
<td>Low</td>
</tr>
<tr class="even">
<td>2</td>
<td>Provider caching (prompt structure)</td>
<td>50-90%</td>
<td>Low</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Model selection (right-size tasks)</td>
<td>60-80%</td>
<td>Low</td>
</tr>
<tr class="even">
<td>4</td>
<td>Batch processing (async high-volume)</td>
<td>50% cost</td>
<td>Low</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Output reduction (structured output)</td>
<td>30-50%</td>
<td>Low</td>
</tr>
<tr class="even">
<td>6</td>
<td>Request consolidation (combine steps)</td>
<td>40-60%</td>
<td>Medium</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Deterministic tools (cache checks)</td>
<td>70%+ for cached ops</td>
<td>Medium</td>
</tr>
<tr class="even">
<td>8</td>
<td>Semantic caching</td>
<td>50-80%</td>
<td>High</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Streaming/parallelization</td>
<td>Latency only</td>
<td>Low-Medium</td>
</tr>
</tbody>
</table>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<ul>
<li><strong>Audit current prompts</strong> for context reduction opportunities</li>
<li><strong>Restructure prompts</strong> for provider caching (static first)</li>
<li><strong>Evaluate model selection</strong> for different task complexities</li>
<li><strong>Identify batch opportunities</strong> for non-urgent high-volume tasks</li>
<li><strong>Identify deterministic operations</strong> to move to MCP tools</li>
<li><strong>Monitor token usage</strong> to validate savings</li>
</ul>
<p>For information flow patterns between phases, see the previous article: <a href="../../03.00-tech/05.02-prompt-engineering/09.00-how_to_manage_information_flow_during_prompt_orchestrations.html">How to Manage Information Flow During Prompt Orchestrations</a>.</p>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>üìö References</h1>
<section id="official-documentation" class="level2">
<h2 class="anchored" data-anchor-id="official-documentation">Official Documentation</h2>
<p><strong><a href="https://platform.openai.com/docs/guides/latency-optimization">OpenAI Latency Optimization Guide</a></strong> üìò [Official]<br>
Seven principles for optimizing latency: process tokens faster, generate fewer tokens, use fewer input tokens, make fewer requests, parallelize, make users wait less, and don‚Äôt default to LLM.</p>
<p><strong><a href="https://platform.openai.com/docs/guides/prompt-caching">OpenAI Prompt Caching Guide</a></strong> üìò [Official]<br>
Comprehensive guide to OpenAI‚Äôs automatic prompt caching, including requirements (1024+ tokens), cache duration, and best practices for structuring prompts to maximize cache hits.</p>
<p><strong><a href="https://platform.claude.com/docs/en/docs/build-with-claude/prompt-caching">Anthropic Prompt Caching Documentation</a></strong> üìò [Official]<br>
Comprehensive guide to Claude‚Äôs prompt caching with <code>cache_control</code> breakpoints, 90% read discount, 25% write premium, 5-minute default or 1-hour extended TTL, up to 4 cache breakpoints, and model-specific minimum token requirements (1,024-4,096 tokens).</p>
<p><strong><a href="https://platform.openai.com/docs/guides/batch">OpenAI Batch API Guide</a></strong> üìò [Official]<br>
Documentation for OpenAI‚Äôs Batch API offering 50% cost discount for async processing with 24-hour completion window and up to 50,000 requests.</p>
<p><strong><a href="https://platform.claude.com/docs/en/docs/build-with-claude/batch-processing">Anthropic Message Batches API</a></strong> üìò [Official]<br>
Documentation for Anthropic‚Äôs batch processing with 50% cost discount, 100,000 request limit (or 256 MB size limit), typically under 1-hour completion, and 29-day result retention.</p>
<p><strong><a href="https://platform.openai.com/docs/guides/predicted-outputs">OpenAI Predicted Outputs</a></strong> üìò [Official]<br>
Guide to using predicted outputs for speculative execution, reducing latency by 2-3√ó when output is largely known in advance.</p>
</section>
<section id="community-resources" class="level2">
<h2 class="anchored" data-anchor-id="community-resources">Community Resources</h2>
<p><strong><a href="https://gptcache.readthedocs.io/">GPTCache Documentation</a></strong> üìó [Verified Community]<br>
Open-source semantic caching library by Zilliz. Provides embedding-based similarity matching to cache LLM responses for similar queries, with support for multiple vector stores and embedding providers.</p>
</section>
<section id="internal-references" class="level2">
<h2 class="anchored" data-anchor-id="internal-references">Internal References</h2>
<p><strong><a href="../../.copilot/context/00.00-prompt-engineering/05-validation-caching-pattern.md">Validation Caching Pattern</a></strong> üìò [Internal]<br>
Repository-specific implementation of the 7-day validation caching pattern using bottom metadata blocks.</p>
<p><strong><a href="../../.copilot/context/00.00-prompt-engineering/02-tool-composition-guide.md">Tool Composition Guide</a></strong> üìò [Internal]<br>
Optimization patterns for tool usage including ‚Äúnarrow before wide‚Äù and lazy loading strategies.</p>
<p><strong><a href="../../.copilot/context/00.00-prompt-engineering/01-context-engineering-principles.md">Context Engineering Principles</a></strong> üìò [Internal]<br>
Token budget guidelines and context window management principles.</p>
</section>
<section id="series-navigation" class="level2">
<h2 class="anchored" data-anchor-id="series-navigation">Series Navigation</h2>
<p><strong>Previous</strong>: <a href="../../03.00-tech/05.02-prompt-engineering/09.00-how_to_manage_information_flow_during_prompt_orchestrations.html">How to Manage Information Flow During Prompt Orchestrations</a><br>
<strong>Series Index</strong>: <a href="../../03.00-tech/05.02-prompt-engineering/02-getting-started/01.00-how_github_copilot_uses_markdown_and_prompt_folders.html">How GitHub Copilot Uses Markdown and Prompt Folders</a></p>
<hr>
<!--
validations:
  grammar:
    status: "not_run"
    last_run: null
    model: null
    outcome: null
    issues_found: 0
  
  readability:
    status: "not_run"
    last_run: null
    model: null
    outcome: null
    flesch_score: null
    grade_level: null
  
  understandability:
    status: "not_run"
    last_run: null
    model: null
    outcome: null
    issues_found: 0
  
  structure:
    status: "not_run"
    last_run: null
    model: null
    outcome: null
    missing_sections: []
  
  fact_check:
    status: "complete"
    last_run: "2026-01-26"
    model: "Claude Opus 4.5"
    outcome: "pass"
    claims_verified: 7
    sources_checked: 7
    notes: "All 7 external references verified. Updated 2 Anthropic URLs (docs.anthropic.com ‚Üí platform.claude.com). Added model-specific token minimums, 1-hour cache TTL details, cache invalidation patterns, and batch caching best-effort note."
  
  logic:
    status: "not_run"
    last_run: null
    model: null
    outcome: null
    issues_found: 0

article_metadata:
  filename: "10.00-how_to_optimize_token_consumption_during_prompt_orchestrations.md"
  created: "2026-01-25"
  last_updated: "2026-01-26"
  word_count: ~5800
  reading_time: "23 min"
  
series:
  name: "Prompt Engineering for GitHub Copilot"
  position: 10
  previous: "09.00-how_to_manage_information_flow_during_prompt_orchestrations.md"
  
cross_references:
  - path: "./09.00-how_to_manage_information_flow_during_prompt_orchestrations.md"
    relationship: "predecessor"
    context: "Covers information flow; this article optimizes token consumption"
  - path: ".copilot/context/00.00-prompt-engineering/05-validation-caching-pattern.md"
    relationship: "implements"
    context: "Deterministic caching pattern referenced in Strategy 8"
  - path: ".copilot/context/00.00-prompt-engineering/02-tool-composition-guide.md"
    relationship: "extends"
    context: "Tool optimization patterns for context reduction"
-->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/darioairoldi\.github\.io\/Learn");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../03.00-tech/05.02-prompt-engineering/09.00-how_to_manage_information_flow_during_prompt_orchestrations.html" class="pagination-link" aria-label="How to Manage Information Flow During Prompt Orchestrations">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">How to Manage Information Flow During Prompt Orchestrations</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../03.00-tech/05.02-prompt-engineering/20-how_to_create_a_prompt_interacting_with_agents.html" class="pagination-link" aria-label="How to Create a Prompt Orchestrating Multiple Agents">
        <span class="nav-page-text">How to Create a Prompt Orchestrating Multiple Agents</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/darioairoldi/Learn/edit/main/03.00-tech/05.02-prompt-engineering/10.00-how_to_optimize_token_consumption_during_prompt_orchestrations.md" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/darioairoldi/Learn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>